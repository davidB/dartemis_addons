import "dart:isolate" as VK;import "dart:async" as qE;import "dart:collection" as rE;import "dart:math" as XC;import "dart:typed_data" as uC;import "dart:html" as DB;class ZJ{static const  aJ="Chrome";static const  bJ="Firefox";static const  cJ="Internet Explorer";final  gI;final  minimumVersion;const ZJ(this.gI,[this.minimumVersion]);}class dJ{const dJ();}class eJ{final  name;const eJ(this.name);}class fJ{const fJ();}class gJ{const gJ();}TG(g){OB(g,[new ZB.bK(50.0,50.0,0.0),new DE(TF(10.0,10.0,fillStyle:zB[3],strokeStyle:zB[0]))]);OB(g,[new ZB.bK(0.0,20.0,0.0),new DE(LH("Hello World, choose an other demo in the list",strokeStyle:zB[0],font:'16px sans-serif'))]);return new qE.Future.value(g);} UG(){new qE.Timer(const Duration(),(){VG();});} VG(){DB.Window.hashChangeEvent.forTarget(DB.window).listen((g){tE(DB.window.location.hash);});tE(DB.window.location.hash);}final nD=new PB();var oD=null; get WG{if(eH){fH(nD,iB.JE,'activeDemo');}return oD;}set WG( g){if(dH(nD)){gH(nD,iB.JE,'activeDemo',oD,g);}oD=g;}var sE=new qE.Future.value(new hJ()); tE( g){var h=(g!=null&&g.length<2)?null:g.substring(2);if(h==null){DB.window.location.hash='/${vC.keys.first}';return;}var j=vC[h];if(j==null){DB.window.location.hash='/${vC.keys.first}';return;}WG=h;sE.then((k)=>k.IG=false);sE=XG(j).then(YG);} XG(h)=>uE((){var g=new ZC();var j=DB.query('canvas#demo');g.PD(new zE());g.PD(new BF());g.SD(new rJ());g.SD(new sJ());g.SD(new GD(steps:1));g.SD(new tJ(j));g.initialize();g.oI();return h(g);});class hJ{var IG=true;}YG(l){var h=-1;var s=new hJ();var mK=DB.query('#statsLoop') as DB.PreElement;var nK=DB.query("#statsLoop_xtchart").xtag;var j=new List<double>(2);var t=new qJ()..gE=(g,k){if(k-g.uF>1000){g.uF=k;var v=1000/g.YE;if(mK!=null){var AB="avg : ${g.YE}\nmax : ${g.max}\nmin : ${g.min}\nfps : ${v}\n";mK.text=AB;}if(nK!=null){j[0]=g.YE;j[1]=v;nK.EJ(j);}if(k-g.HG>3000)g.reset();}};var TB=1000.0/30;m( n)=>uE((){if(s.IG)DB.window.requestAnimationFrame(m);t.start();try {l.tB=(h>0)?XC.min(n-h,TB):0;l.process();h=n;}on Object catch (KB,bB){print(KB);print(bB);}t.stop();});DB.window.requestAnimationFrame(m);return s;}uE(h){try {return h();}on Object catch (g,j){print(g);print(j);throw g;}}var vE=0xe3e3f8ff;var yB=vG(KF(vE)).map((g)=>BD(LF(g))).toList();var zB=wG(sG(vE),4).map((g)=>BD(tG(g))).toList();final vC={'proto2d':TG,'proto2d + animatable':(g){OB(g,[new ZB.bK(50.0,50.0,0.0),new DE(TF(10.0,20.0,fillStyle:zB[1],strokeStyle:zB[0])),new dC()..add(new NF()..MC=(l,k,m){var KB=l.RB(ZB.ED);KB.u.x=bC(wD,10000)(k,1000,100);KB.u.y=bC(yG(BH),2000)(k,100,100);return true;})]);return new qE.Future.value(g);},'proto2d + animatable + emitter (particles)':(g){g.bD(GD)..cD.y=0.0..steps=1..aB=new lJ(new nJ(),new kJ());pD(g,DB.query('canvas#demo'),false,false);OB(g,[new ZB.bK(50.0,50.0,0.0),new zD()..oC=((v)=>new CB(v,inertia0:0.0))..XD=QF(100)..mB.add(AE(SF(new q(0.0,0.0,0.0),new q(800.0,100.0,0.0),bC(MF,3000)),true))..mB.add(BE([()=>new DE(DD(3.0,fillStyle:yB[0],strokeStyle:zB[1])),()=>new dC()..add(new NF()..MC=(){var TB=[] ;return (l,k,m){var j=l.RB(CB.FC);var SG=(k-m)/10000;if(k==m){TB=new List(j.u.length);for(var h=j.u.length-1;h>-1; --h){TB[h]=j.u[h].y;}}for(var h=j.u.length-1;h>-1; --h){j.u[h].y=CH(SG,200,TB[h]);}return (SG<1.0);};}()..onEnd=(l,k,m){l.ZD();})]))]);OB(g,[new ZB.bK(600.0,50.0,0.0),new zD()..oC=((v)=>new CB(v,withColors:true,color0:0xff0000ff,radius0:4.0,withCollides:true,collide0:0,intraCollide:true,inertia0:0.98))..XD=QF(100)..mB.add(AE(KH(new q.fK()),true))..mB.add(PF(SF(new q.fK(),new q(5.0,0.0,0.0),bC(MF,3000)),true))..mB.add(BE([()=>new DE(DD(1.0,fillStyle:yB[0],strokeStyle:yB[1])),()=>new hB(),()=>new dC()..add(new NF()..MC=((l,k,m)=>k-m<5000)..onEnd=((l,k,m)=>l.ZD()))..add(new NF()..MC=(l,k,m){var SJ=zG(wD,5000)(k-m,-255.0,255.0).toInt();var j=l.RB(CB.FC);for(int h=0;h<j.length;h++ ){j.color[h]=(j.color[h]&0xffffff00)|SJ;};return k-m<5001;})])),new dC()..add(new NF()..MC=(l,k,m){var KB=l.RB(ZB.ED);KB.NC.z=bC(wD,3000)(k-m,XC.PI*2,0.0);return true;})]);return new qE.Future.value(g);},'verlet shapes':(g){g.bD(GD)..cD.y=10.0..steps=3..aB=new lJ(new nJ(),new mJ());pD(g,DB.query('canvas#demo'),true,false);var t=RH([new QH(CB.FC,DD(5.0,fillStyle:yB[0],strokeStyle:yB[1])),new QH(hB.FD,PH(distanceStyleCollide:"#e20000"))]);var s=(v)=>new CB(v,withCollides:true,collide0:1,color0:0x00A000FF,inertia0:0.99);var mD=OB(g,WF([new q(20.0,10.0,0.0),new q(40.0,10.0,0.0),new q(60.0,10.0,0.0),new q(80.0,10.0,0.0),new q(100.0,10.0,0.0)],0.02,false,s).toList()..add(new DE(t)));SC(mD,0);SC(mD,4);var TJ=OB(g,HD(new q(200.0,50.0,0.0),50.0,30,0.3,0.9,s).toList()..add(new DE(t)));HC(TJ,1);var UJ=OB(g,HD(new q(400.0,50.0,0.0),70.0,7,0.1,0.2,s).toList()..add(new DE(t)));HC(UJ,1);var VJ=OB(g,HD(new q(600.0,50.0,0.0),70.0,3,1.0,1.0,s).toList()..add(new DE(t)));HC(VJ,1);var UK=OB(g,TH(new q(800.0,50.0,0.0),new q(300.0,0.0,0.0),new q(0.0,200.0,0.0),15,14,0.5,s).toList()..add(new DE(t)));var WJ=OB(g,HD(new q(600.0,300.0,0.0),70.0,4,1.0,1.0,s).toList()..add(new DE(t)));HC(WJ,1);var XJ=OB(g,GE(new q(400.0,300.0,0.0),new q(70.0,0.0,0.0),new q(0.0,70.0,0.0),1.0,s).toList()..add(new DE(t)));HC(XJ,1);var YJ=OB(g,GE(new q(200.0,300.0,0.0),new q(70.0,10.0,0.0),new q(10.0,30.0,0.0),1.0,s).toList()..add(new DE(t)));HC(YJ,1);var AB=OB(g,GE(new q(10.0,380.0,0.0),new q(1100.0,0.0,0.0),new q(0.0,10.0,0.0),1.0,s).toList()..add(new DE(t)));SC(AB,0);SC(AB,1);SC(AB,2);SC(AB,3);HC(AB,1);return new qE.Future.value(g);},'collisions':(g){var oB=DB.query('canvas#demo');var PC=oB.width;var tC=oB.height;var bB=10;var QC=10;g.bD(GD)..cD.y=0.0..steps=3..aB=new lJ(new nJ(),new kJ());pD(g,oB,true,true);OB(g,[new ZB.bK(50.0,50.0,0.0),new zD()..oC=((v)=>new CB(v,withRadius:true,radius0:3.0,withColors:true,color0:0xff0000ff,withCollides:true,collide0:1,intraCollide:true))..XD=JH(500)..mB.add(AE(RF(new q(PC/2,tC/2,0.0),new q(PC/2-bB,tC/2-QC,0.0)),true))..mB.add(PF(RF(new q.fK(),new q(3.0,3.0,0.0)),false))..mB.add(BE([()=>new DE(DD(1.0,fillStyle:yB[0],strokeStyle:yB[1])),()=>new hB(),()=>new dC()..add(new NF()..MC=(l,k,m){var j=l.RB(CB.FC);var n=true;for(var h=j.u.length-1;h>-1; --h){n=true;n=n&&j.u[h].y>QC;n=n&&j.u[h].y<(tC-QC);n=n&&j.u[h].x>bB;n=n&&j.u[h].x<(PC-bB);if(!n){j.u[h].FB(j.vB[h]);}}return true;}..onEnd=(l,k,m){l.ZD();})]))]);return new qE.Future.value(g);}};pD(k,l,t,n){var s=l.width;var v=l.height;var j=10;var m=10;var h=new RC(0.0-j,0.0-m,s+2*j,v+2*m,10);var g=k.bD(GD);g.aB=(t)?new oJ(g.aB.jB,g.aB.nB,grid:h):new lJ(new nJ(),new kJ());if(n)OB(k,[new DE(nG(h,zB[2],BD(0x00f000ff)))]);} ZG(){var oK=DB.document.body;final pK=new DB.Element.html('<li class=""><a></a></li>');var qK,rK;var sK=new PE(oK);qK=oK.nodes[1].nodes[5].nodes[1].nodes[1];sK.loop(qK,()=>vC.keys,(k,j,sK){var g=k[j];var tK,uK;uK=pK.clone(true);tK=uK.nodes[0];var vK=sK.kI(()=>g,false);tK.nodes.add(vK);sK.CJ(()=>'#/${g}',(h){if(tK.href!=h)tK.href=h;},false,true);sK.fI(uK,()=>(WG==g)?'active':'',false);sK.addAll([new DB.Text('\n            '),uK,new DB.Text('\n          ')]);});rK=oK.nodes[1].nodes[7].nodes[3];sK.WC(new iJ()..host=rK);sK.KC();sK.insert();}main(){gF=true;sB.IE.zI.listen((g){print('${g.pC.name.toLowerCase()}: ${g.message}');});UG();ZG();}class iJ extends jF{var wK;static final aG=new DB.DocumentFragment.html('''
        <canvas style="width:100%;height:100%"></canvas>
      ''');var xK; nI(){var yK=createShadowRoot("x-tchart");PJ("x-tchart",new WE({"x-tchart":"[is=\"x-tchart\"]"}));wK=rI("x-tchart");xK=new PE(yK);yK.nodes.add(aG.clone(true));xK.KC();} sI(){xK.insert();} HJ(){xK.remove();xK=null;}var pE=0.0;var RG=100.0;var zK=null;var stack=false;var pF=['rgb(153, 216, 201)','rgb(158, 188, 218)','rgb(253, 187, 132)','rgb(201, 148, 199)','rgb(188, 189, 220)','rgb(161, 217, 155)','rgb(189, 189, 189)'];mC(g,h)=>XC.max(0,XC.min(g,h));EJ( l){var n=zK;var g=n.context2d;var oB=0.5;var bB=0.5;var v=n.width;var s=n.height;g.save();QJ(g,v,s,-1,0);if(l!=null){var KB=l.length;var t=s/KB;var TB=t/(RG-pE);var AB=oB+v-1;var h=bB+s-1;var k=0;for(var j=KB-1;j>-1;j-- ){var m=l[j];if(m==null)m=pE;g.beginPath();k=mC(RG,(m-pE))*TB;g.moveTo(AB,h-k);g.lineTo(AB,h);g.closePath();g.strokeStyle=pF[j%pF.length];g.stroke();h=(stack)?h-k:h-t;}g.restore();}}QJ(j,g,h,l,k){var m=j.getImageData(mC(g,-l),mC(h,-k),mC(g,g-l),mC(h,h-k));j.putImageData(m,0,0);j.clearRect(g-1,0,1,h);} eD(){zK=this.query('canvas') as DB.CanvasElement;}}abstract class wE{ TD( g); aE( g); LC( g); enabled( g); disabled( g);}class rD extends pB{var AL;var CL;var IL;var JL=0;var KL=0;var LL=0;var FL=0;var SL;rD():AL=new BB<o>(),CL=new BB<o>(),IL=new BB<bool>(),SL=new jG(); initialize(){} oL(){var g=CL.removeLast();if(null==g){g=new o.XK(DL,SL.hI());}LL++ ;return g;} TD( g){JL++ ;KL++ ;AL[g.id]=g;} enabled( g){IL[g.id]=false;} disabled( g){IL[g.id]=true;} LC( g){AL[g.id]=null;IL[g.id]=false;CL.add(g);JL-- ;FL++ ;} isActive( g)=>AL[g]!=null;}class bG{static var xE=0;static var wC;static  dG( h){if(null==wC){wC=new Map<Type,int>();}var g=wC[h];if(g==null){g=1<<xE;xE++ ;wC[h]=g;}return g;}}class qD extends pB{var BL;var FL;qD():BL=new BB<BB<JB>>(),FL=new BB<o>(); initialize(){} XL( g){aL(g,(h,j){h[g.id].ZL();h[g.id]=null;});g.gL=0;} lL( j, k, l){var h=k.id;BL.rL(h);var g=BL[h];if(g==null){g=new BB<JB>();BL[h]=g;}g[j.id]=l;j.wL(k.nF);} yF( j){var h=j.id;BL.rL(h);var g=BL[h];if(g==null){g=new BB<JB>();BL[h]=g;}return g;} DM( h, k){var j=k.id;var g=BL[j];if(g!=null&&g.jE(h.id)){return g[h.id];}return null;} aL( j, k( components, index)){var g=j.gL;var h=0;while (g>0){if((g&1)==1){k(BL[h],h);}h++ ;g=g>>1;}} LC( g)=>FL.add(g); iI(){FL.forEach((g)=>XL(g));FL.clear();}}class gB{static var sD=1;static var cG=0;var EL=0;var GL=0;gB(){EL=sD;sD=sD<<1;GL=cG++ ;} get nF=>EL; get id=>GL;}class AC{static var yE=new Map<Type,gB>();static  BC( h){var g=yE[h];if(g==null){g=new gB();yE[h]=g;}return g;}static  fG( g)=>BC(g).nF;}abstract class pB implements wE{var DL; initialize(); TD( g){} aE( g){} LC( g){} disabled( g){} enabled( g){}}class YC<NB>{var HL;YC.WK(this.HL); operator[]( g)=>HL[g]; get size=>HL.size; get isEmpty=>HL.isEmpty; contains( g)=>HL.contains(g); forEach( g( element))=>HL.forEach(g);}class o{final  id;var eL=0;var gL=0;var wC=0;var DL;var YL;var cL;o.XK(this.DL,this.id){YL=DL.vF;cL=DL.dE;} wL( g){gL|= g;} AM( g){wC|= g;} BM( g){wC&= ~g;} toString()=>"Entity[${id}]"; XE( g){cL.lL(this,AC.BC(g.runtimeType),g);} RB( g){return cL.DM(this,g);} ZD()=>DL.tF(this);}abstract class tD extends CC{tD( g):super(g); kD( g); mE( h)=>h.forEach((g)=>kD(g)); bE()=>true;}abstract class eG extends CC{var PL=0;var TL=0;final  VL; get tB=>TL;eG(this.VL, g):super(g); bE(){PL+= SB.tB;TL+= SB.tB;if(PL>=VL){PL-= VL;return true;}return false;} end(){TL=0;}}class zE extends pB{var OL;var WL;zE(){OL=new Map<o,String>();WL=new Map<String,BB<o>>();} OJ( j, h){OL[j]=h;var g=WL[h];if(g==null){g=new BB<o>();WL[h]=g;}g.add(j);} GJ( g){var h=OL[g];if(h!=null){var j=WL[h];if(j!=null){j.remove(g);}}} initialize(){} LC( g)=>GJ(g);}class xC<yC extends JB>{var QL;var UL;xC( h, g){this.QL=AC.BC(h);UL=g.dE.yF(this.QL);}yC get( g)=>UL[g.id] as yC; iE( g){if(UL.jE(g.id)){return UL[g.id] as yC;}return null;}}class BB<NB>{var ML;var NL=0;var RL;BB({ capacity: 16}):ML=new List(capacity){RL=new YC.WK(this);} operator[]( g)=>ML[g]; get size=>NL; get readOnly=>RL; get isEmpty=>NL==0; forEach( h( element)){for(int g=0;g<NL;g++ ){h(ML[g]);}} removeAt( g){var h=ML[g];ML[g]=ML[ --NL];ML[NL]=null;return h;} removeLast(){if(NL>0){var g=ML[ --NL];ML[NL]=null;return g;}return null;} remove( j){for(int g=0;g<NL;g++ ){var h=ML[g];if(j==h){ML[g]=ML[ --NL];ML[NL]=null;return true;}}return false;} contains( h){for(int g=0;NL>g;g++ ){if(h==ML[g]){return true;}}return false;} removeAll( j){var k=false;for(int h=0;h<j.size;h++ ){var l=j[h];for(int g=0;g<size;g++ ){var m=ML[g];if(l==m){removeAt(g);g-- ;k=true;break;}}}return k;} get oF=>ML.length; add( g){if(NL==ML.length){KM();}ML[NL++ ]=g;} operator[]=( g, h){if(g>=ML.length){LM(g*2);}if(NL<=g){NL=g+1;}ML[g]=h;} KM(){var g=((ML.length*3)/2+1).toInt();LM(g);} LM( h){var g=ML;ML=new List<NB>(h);ML.setRange(0,g.length,g);} rL( g){if(g>=ML.length){LM(g*2);}} clear(){for(int g=0;g<NL;g++ ){ML[g]=null;}NL=0;} addAll( h){for(int g=0;h.size>g;g++ ){add(h[g]);}} jE( g)=>g<oF; toString()=>"[${ML.join(',')}]";}class AF{static var uD=new Map<Type,BB<DC>>();static DC gG( j, k){var h=hG(j);var g=h.removeLast();if(null==g){g=k();}return g;}static  hG( h){var g=uD[h];if(null==g){g=new BB();uD[h]=g;}return g;}static  iG( g){uD[g.runtimeType].add(g);}}abstract class JB{ ZL(){}}class ZC{final  YL=new rD();final  cL=new qD();final  KL=new BB<o>();final  jL=new BB<o>();final  FL=new BB<o>();final  qL=new BB<o>();final  sL=new BB<o>();final  tL=new Map<Type,CC>();final  uL=new List<CC>();final  vL=new Map<Type,pB>();final  xL=new BB<pB>();var tB=0;var yL=0;var zL=0.0;ZC(){PD(YL);PD(cL);} initialize(){xL.forEach((h)=>h.initialize());uL.forEach((g)=>g.initialize());} get vF=>YL; get dE=>cL; PD( g){vL[g.runtimeType]=g;xL.add(g);g.DL=this;} zF( g){return vL[g];} fE(){return YL.oL();} SD( g,{ passive: false}){g.SB=this;g.pL=passive;tL[g.runtimeType]=g;uL.add(g);return g;} bD( g){return tL[g];} EM( j, h(EntityObserver,Entity)){j.forEach((g){xL.forEach((k)=>h(k,g));uL.forEach((l)=>h(l,g));});j.clear();} process(){yL++ ;zL+= tB;EG();uL.forEach((g){if(!g.DJ){g.process();}});} EG(){EM(KL,(h,g)=>h.TD(g));EM(jL,(h,g)=>h.aE(g));EM(sL,(h,g)=>h.disabled(g));EM(qL,(h,g)=>h.enabled(g));EM(FL,(h,g)=>h.LC(g));cL.iI();} oI(){vF.AL.forEach((g){if(null!=g){tF(g);}});EG();} mF( g)=>KL.add(g); tF( g){if(!FL.contains(g)){FL.add(g);}}}class BF extends pB{final  bL;final  dL;BF():bL=new Map<String,BB<o>>(),dL=new Map<o,BB<String>>(); initialize(){} add( j, k){var h=bL[k];if(h==null){h=new BB<o>();bL[k]=h;}h.add(j);var g=dL[j];if(g==null){g=new BB<String>();dL[j]=g;}g.add(k);} remove( g, h){var k=bL[h];if(k!=null){k.remove(g);}var j=dL[g];if(j!=null){j.remove(h);}} FJ( h){var g=dL[h];if(g!=null){g.forEach((k){var j=bL[k];if(j!=null){j.remove(h);}});g.clear();}} LC( g)=>FJ(g);}abstract class CC implements wE{var fL=0;var SB;var hL;var iL;var kL;var mL;var nL;var pL;CC( g):hL=new BB<o>(),iL=g.dI,kL=g.qI,mL=g.BJ{nL=iL==0&&mL==0;fL=bG.dG(runtimeType);}get DJ=>pL; UD(){} process(){if(bE()){UD();mE(hL.readOnly);end();}} end(){} mE( g); bE(); initialize(){} eD( g){} oE( g){} EM( g){if(nL){return;}var j=FM(g);var h=(iL&g.gL)==iL;if(mL>0&&h){h=(mL&g.gL)>0;}if(kL>0&&h){h=(kL&g.gL)==0;}if(h&&!j){IM(g);}else if(!h&&j){JM(g);}} FM( g)=>(fL&g.wC)==fL; IM( g){hL.add(g);g.AM(fL);eD(g);} JM( g){hL.remove(g);g.BM(fL);oE(g);} TD( g)=>EM(g); aE( g)=>EM(g); enabled( g)=>EM(g); LC( g){if(FM(g)){JM(g);}} disabled( g){if(FM(g)){JM(g);}}}class CF extends JB with DC{ ZL(){wI();} VD(){}}class cB{var iL=0;var kL=0;var mL=0; eI( g){iL=CM(iL,g);return this;}static  zC( h){var g=new cB();g.eI(h);return g;} get dI=>iL; get qI=>kL; get BJ=>mL; CM( g, h){if(null!=h){h.forEach((j){g=g|AC.fG(j);});}return g;}}typedef  DF();abstract class DC{factory DC.YK( g, h){return AF.gG(g,h);} VD(); wI(){VD();AF.iG(this);}}class jG{var GM;var HM=0;jG():GM=new BB<int>(); hI(){if(GM.size>0){return GM.removeLast();}return HM++ ;}}abstract class vD{ WD( k, h, g, j, l); cE( j, g, k, h);}abstract class aC{ reset(); QD( g); RD( g); dD();}abstract class AD{ iD( j, g, k, h); rC( l, h, g, j, k);}class jJ implements aC{ reset(){} QD( g)=>true; RD( g)=>true; dD(){}}class kJ implements AD{ iD( j, g, k, h){} rC( l, h, g, j, k){}}class lJ implements aC{final  MM=new List();final  NM=new List();final  jB;final  nB;final  OM=new EB.fK();lJ(this.jB,this.nB); reset(){MM.clear();NM.clear();} QD( h){var g=false;for(int j=0;j<h.length; ++j){var k=h.collide[j];h.collide[j]=k*k;g=g||(h.collide[j]!=0);}g=g&&(h.length>0);if(g){MM.add(h);}return g;} RD( g){if(g.collide!=0){g.collide=1;NM.add(g);return true;}return false;} dD(){for(int g=0;g<MM.length; ++g){PM(g);QM(g);RM(g);}} PM( m){var k=MM[m];for(int l=m+1;l<MM.length; ++l){var j=MM[l];for(int g=0;g<k.length; ++g){if(k.collide[g]!=0){for(int h=0;h<j.length; ++h){if(j.collide[h]!=0){if(jB.WD(k,g,j,h,OM)){nB.rC(k,g,j,h,OM.OC);}}}}}}} RM( k){var g=MM[k];if(!g.intraCollide)return;for(int h=0;h<g.length; ++h){if(g.collide[h]!=0){for(int j=h+1;j<g.length; ++j){if(g.collide[j]!=0){if(jB.WD(g,h,g,j,OM)){nB.rC(g,h,g,j,OM.OC);}}}}}} QM( l){var h=MM[l];for(int k=0;k<NM.length; ++k){var j=NM[k];if(h==j.w)continue;for(int g=0;g<h.length; ++g){if(h.collide[g]!=0){if(jB.cE(h,g,j,OM)){nB.iD(h,g,j,OM.OC);}}}}}}class mJ implements AD{ZE( g, h, j){g.YB(h).scale(j).add(h);h.fB(g.x,g.y,g.z);} iD( k, j, g, l){var h=0.5*l;ZE(k.u[j],k.vB[j],h);ZE(g.w.u[g.kB],g.w.vB[g.kB],h);ZE(g.w.u[g.lB],g.w.vB[g.lB],h);} rC( v, AB, s, n, TB){var g=v.u[AB];var l=s.u[n];var h=g.x-l.x;var k=g.y-l.y;var KB=h*h+k*k;var m=XC.sqrt(KB);var t=v.wB[AB]+s.wB[n];if(m<t){var j=(m-t)/m;g.x-= h*j*0.5;g.y-= k*j*0.5;l.x+= h*j*0.5;l.y+= k*j*0.5;}}}class RC{final SM=new dB();final TM=new q.fK();final  maxDepth;final  hD;final VM=new List();final XM=new List<RC>(4);var ZM=true;RC(h,g,j,k,[this.maxDepth=4, l=4]):this.hD=l<<1{SM.min.fB(h,g,0.0);SM.max.fB(h+j,g+k,0.0);TM.FB(SM.min).add(SM.max).scale(0.5);}get qC=>(VM.length>>1)+((ZM)?0:(XM[0].qC+XM[1].qC+XM[2].qC+XM[3].qC));get xI=>VM.length>>1;reset(){VM.clear();ZM=true;} insert( h,j){var g=wF(h);if(g!=null){g.aM(h,j);}return (g!=null);} wF( g){if(g.min.x<SM.min.x||g.max.x>SM.max.x||(g.min.y<SM.min.y)||g.max.y>SM.max.y){return null;}return bM(g);}bM( j){var h=null;if(!ZM){var g=(j.min.y<=TM.y)?0:2;g=(j.min.x<=TM.x)?g:g+1;h=XM[g].wF(j);}return (h==null)?this:h;}aM( k,j){if(ZM&&maxDepth>0&&VM.length>=hD){eM();var h=new List.from(VM,growable:false);VM.clear();for(var g=0;g<h.length;g+= 2){insert(h[g],h[g+1]);}insert(k,j);}else{VM.add(k);VM.add(j);}}eM(){if(XM[0]==null){var m=SM.min.x;var j=SM.min.y;var g=TM.x-SM.min.x;var h=TM.y-SM.min.y;var k=hD>>1;var l=maxDepth-1;XM[0]=new RC(m,j,g,h,l,k);XM[1]=new RC(m+g,j,g,h,l,k);XM[2]=new RC(m,j+h,g,h,l,k);XM[3]=new RC(m+g,j+h,g,h,l,k);}else{XM[0].reset();XM[1].reset();XM[2].reset();XM[3].reset();}ZM=false;}JG( j){for(var g=1;g<VM.length;g+= 2){var k=VM[g];for(var h=g+2;h<VM.length;h+= 2){j(k,VM[h]);}iM(j,k);}if(!ZM){for(var g=0;g<4; ++g){XM[g].JG(j);}}}iM( j,k){if(ZM)return;for(var g=0;g<4; ++g){var h=XM[g];h.jM(j,k);h.iM(j,k);}}jM( h,j){for(var g=1;g<VM.length;g+= 2){h(j,VM[g]);}}}class nJ implements vD{final  UM=new yJ();WD( g, h, k, j, m){var l=UM.MG(g.u[h],g.wB[h],k.u[j],g.wB[j]);if(l){g.collide[h]=-1;k.collide[j]=-1;}return l;}cE( k, j, g, l){var h=false;h=h||UM.KG(g.w.u[g.kB],g.w.u[g.lB],k.u[j],k.wB[j]);if(h){k.collide[j]=-1;g.collide=-1;}return h;}}class oJ implements aC{final  WM;final  jB;final  nB;final  OM=new EB.fK();final YM=new pJ<qB>()..qF=qB.kG..GG=qB.lG;oJ(this.jB,this.nB,{ grid}):WM=(grid==null)?new RC(-500.0,-500.0,1000.0,1000.0,10):grid; reset(){WM.reset();YM.reset();} QD( h){if(h.length<1)return false;var k=false;for(int g=h.length-1;g>=0; --g){k=k||h.collide[g]!=0;}if(k){for(int g=h.length-1;g>=0; --g){h.collide[g]=1;var j=YM.FG();j.w=h;j.uB=g;UH(h.u[g],h.wB[g],j.lC);WM.insert(j.lC,j);}}return k;} RD( g){if(g.collide!=0){g.collide=1;var h=YM.FG();h.IB=g;VH(g.w.u[g.kB],g.w.u[g.lB],0.0,h.lC);WM.insert(h.lC,h);return true;}return false;} dD(){WM.JG(cM);}cM( g, h){if(g.w!=null&&h.w!=null)dM(g,h);else if(g.w!=null&&h.IB.w!=null)fM(g,h);else if(h.w!=null&&g.IB.w!=null)fM(h,g);else{}}dM( g, h){if(g.w!=h.w||g.w.intraCollide){if(jB.WD(g.w,g.uB,h.w,h.uB,OM)){nB.rC(g.w,g.uB,h.w,h.uB,OM.OC);}}}fM( g, h){if(g.w!=h.IB.w||g.w.intraCollide){if(jB.cE(g.w,g.uB,h.IB,OM)){nB.iD(g.w,g.uB,h.IB,OM.OC);}}}}class qB{final lC=new dB();var w;var uB;var IB;static kG()=>new qB();static lG(g){g.w=null;g.uB=-1;g.IB=null;}}class pJ<mG>{var qF;var GG;final gM=new List<mG>();var hM=0; FG(){var g=null;if(hM==gM.length){g=qF();gM.add(g);}else{g=gM[hM];GG(g);}hM++ ;return g;}reset(){hM=0;}get oF=>gM.length;}nG( h,k,j)=>(g, l, m){g.beginPath();EF(h,g);g.strokeStyle=k;g.stroke();g.fillStyle=j;FF(h,g);};EF( g,h){if(!g.ZM){h.moveTo(g.SM.min.x,g.TM.y);h.lineTo(g.SM.max.x,g.TM.y);h.moveTo(g.TM.x,g.SM.min.y);h.lineTo(g.TM.x,g.SM.max.y);for(var j=0;j<4; ++j){EF(g.XM[j],h);}}}FF( g,j){j.fillText("${g.qC}/${g.xI}/${g.hD>>1}[${g.maxDepth}]",g.TM.x,g.TM.y);if(!g.ZM){for(var h=0;h<4; ++h){FF(g.XM[h],j);}}}oG( g)=>((g&0xff000000)>>24);GF( g)=>((g&0xff000000)>>24)/255.0;pG( g)=>((g&0x00ff0000)>>16);HF( g)=>((g&0x00ff0000)>>16)/255.0;qG( g)=>((g&0x0000ff00)>>8);IF( g)=>((g&0x0000ff00)>>8)/255.0;rG( g)=>((g&0x000000ff))/255.0; JF( g, h, j){return 0x000000ff|((g*255).toInt()<<24)|((h*255).toInt()<<16)|((j*255).toInt()<<8);} KF( t){var j=GF(t);var h=HF(t);var m=IF(t);var g=XC.max(XC.max(j,h),m);var k=XC.min(XC.min(j,h),m);var n,s,v=(g+k)/2;if(g==k){n=s=0;}else{var l=g-k;s=v>0.5?l/(2-g-k):l/(g+k);n=(g==j)?(h-m)/l+(h<m?6:0):(g==h)?(m-j)/l+2:(j-h)/l+4;n/= 6;}return [n,s,v];} LF( v){var m,s,t;var n=v[0];var l=v[1];var k=v[2];AB(g,j,h){if(h<0)h+= 1;if(h>1)h-= 1;if(h<1/6)return g+(j-g)*6*h;if(h<1/2)return j;if(h<2/3)return g+(j-g)*(2/3-h)*6;return g;}if(l==0.0){m=s=t=k;}else{var j=k<0.5?k*(1+l):k+l-k*l;var g=2*k-j;m=AB(g,j,n+1/3);s=AB(g,j,n);t=AB(g,j,n-1/3);}return JF(m,s,t);}sG( n){var j=GF(n);var h=HF(n);var k=IF(n);var g=XC.max(XC.max(j,h),k);var s=XC.min(XC.min(j,h),k);var m,t,v=g;var l=g-s;t=(g==0.0)?0.0:l/g;if(g==s){m=0.0;}else{m=(g==j)?(h-k)/l+(h<k?6:0):(g==h)?(k-j)/l+2:(j-h)/l+4;m/= 6;}return [m,t,v];}tG( m){var t=m[0]*6;var v=m[1];var s=m[2];var g=s*v;var l=g*(1-(t%2-1).abs());var AB=t.floor()%6;var h=0.0;var j=0.0;var k=0.0;switch (AB){case 0:h=g;j=l;k=0.0;break;case 1:h=l;j=g;k=0.0;break;case 2:h=0.0;j=g;k=l;break;case 3:h=0.0;j=l;k=g;break;case 4:h=l;j=0.0;k=g;break;case 5:h=g;j=0.0;k=l;break;}var n=s-g;return JF(h+n,j+n,k+n);}uG( g){g[0]=(g[0]+0.5)%1.0;return g;}vG( g){var h=g[0];return [g,[(h+0.25)%1.0,g[1],g[2]],[(h+0.50)%1.0,g[1],g[2]],[(h+0.75)%1.0,g[1],g[2]]];} wG( g,[ l=6]){var n=g[0],m=g[1],k=g[2];var j=new List<List<double>>(l);var s=1.0/l;j[0]=g;for(var h=1;h<l; ++h){k=(k+s)%1.0;j[h]=[n,m,k];}return j;}BD( g){var h=oG(g);var j=pG(g);var k=qG(g);var l=rG(g);return 'rgba(${h}, ${j}, ${k}, ${l})';}xG( j)=>( h, g, k){return j(h,-g,k+g);};yG( h)=>( g, l, j){g=g*2.0;var k=l;return (g<1.0)?h(g,k,j):xG(h)(g-1.0,k,j);};bC( h, l)=>( g, j, k){g=(g/l);g=g-g.toInt();return h(g,j,k);};zG( j, h)=>( g, k, l){g=(g<h)?(g/h):1.0;return j(g,k,l);};typedef  cC( ratio, change, baseValue); wD( g, j, h){return j*g+h;} MF( g, j, h){var k=(g>0.0&&g<1.0)?AH.nextDouble():g;return j*k+h;}final AH=new XC.Random(); BH( g, k, j){var h=g;if(!(g==0.0||g==1.0)){g=g-1.0;h=-XC.pow(2.0,10.0*g)*XC.sin((g-0.3/4.0)*(2.0*XC.PI)/0.3);}return h*k+j;} CH( g, j, h){var k=1.0-DH(1.0-g,1.0,0.0);return k*j+h;} DH( g, j, h){if(g<1/2.75){g=7.5625*g*g;}else if(g<2/2.75){g=g-1.5/2.75;g=7.5625*g*g+0.75;}else if(g<2.5/2.75){g=g-2.25/2.75;g=7.5625*g*g+0.9375;}else{g=g-2.625/2.75;g=7.5625*g*g+0.984375;}return g*j+h;}class qJ{var gE;var uF=0.0;var HG=0.0;var min;var max;var total;var count;var kM;final lM=DB.window.performance;get YE=>(count==0)?0.0:total/count;qJ(){reset();start();}start(){kM=lM.now();}stop(){var g=lM.now();RJ(g-kM);if(gE!=null){gE(this,g);}}RJ( g){if(min>g)min=g;if(max<g)max=g;count++ ;total+= g;}reset(){HG=lM.now();min=double.MAX_FINITE;max=double.MIN_POSITIVE;total=0.0;count=0;}}class dC extends CF{final MB=new uJ<NF>();dC.ZK();static EH()=>new dC.ZK();factory dC(){var g=new DC.YK(dC,EH);g.VD();return g;} VD(){MB.clear();} add( g){MB.add(g);return this;}}typedef  FH( e, t, t0);typedef  GH( e, t, t0);typedef  HH( e, t, t0); xD( g, j, h){return false;}class NF{var mM=-1.0;var yI=xD;var MC=xD;var onEnd=xD;var next=null;}class rJ extends tD{var nM;var oM=0.0;rJ():super(cB.zC([dC])); initialize(){nM=new xC<dC>(dC,SB);} UD(){oM+= SB.tB;} kD( h){var k=nM.get(h);k.MB.uI((g){if(g.mM<0){g.mM=oM;g.yI(h,oM,g.mM);}var j=(g.mM<=oM)?g.MC(h,oM,g.mM):true;if(!j){g.onEnd(h,oM,g.mM);}return j?g:g.next;});}}typedef  yD(dt, emitter, product);typedef  CD(dt);typedef  eC( v,dt);class zD extends JB{final mB=new List<yD>();var XD=IH();var oC=null;var AJ=false;}class sJ extends tD{var pM;var qM=0;sJ():super(cB.zC([zD])); initialize(){pM=new xC<zD>(zD,SB);} UD(){qM=SB.tB;} kD( h){var g=pM.get(h);var j=g.XD(qM);var k=(g.oC!=null)?rM(j,g.oC):sM(j);g.mB.forEach((m)=>m(qM,h,k));k.forEach((l)=>SB.mF(l));if(g.AJ)h.ZD();} sM( g){return new List<o>.generate(g,(h)=>SB.fE());} rM( h, j){var g=SB.fE();g.XE(j(h));return new List<o>.filled(1,g);}}OF( k,l(Particules,i)){k.forEach((j){var h=j.RB(CB.FC) as CB;if(h!=null){for(var g=0;g<h.length;g++ ){l(h,g);}}});} AE( s, t)=>(j, m, k){var l=m.RB(ZB.ED) as ZB;var n=l.u;OF(k,(h,g){s(h.u[g],j);if(t)h.u[g].add(n);});}; PF( t, v)=>(m, s, n){var g=new GB.iK();if(v){var j=s.RB(ZB.ED) as ZB;g.JJ(j.NC.x);g.KJ(j.NC.y);g.LJ(j.NC.z);}OF(n,(l,k){var h=t(l.vB[k],m);h=g.IJ(h);h.add(l.u[k]);});}; BE( j)=>(l, m, h){h.forEach((g){j.forEach((k)=>g.XE(k()));});}; IH()=>(g)=>0; JH(h)=>((g)=>(g==0)?h:0); QF( g){var tM=0;var uM=(g>0)?1000/g:0;return (j){tM+= j;var h=((g*tM)/1000).round();tM-= h*uM;return h;};}final CE=new XC.Random(); KH( g)=>(h,j)=>h.FB(g); RF( j, h)=>(g,k){g.FB(j);g.x+= (CE.nextDouble()-0.5)*2*h.x;g.y+= (CE.nextDouble()-0.5)*2*h.y;g.z+= (CE.nextDouble()-0.5)*2*h.z;return g;}; SF( j, l, n){var m=l-j;var h=0.0;return (g,k){g.FB(m).scale(n(h,1.0,0)).add(j);h+= k;return g;};}typedef  EC( nb);class CB extends JB{static final FC=AC.BC(CB);final  length;var u;final  DG;final  vB;final  color;final  kE;final  wB;final  collide;var intraCollide;final  lF;final  AG;var OK;CB(g,{withPrevious: true,withColors: false,color0: 0x000000ff,withMass: false,mass0: 1.0,withRadius: false,radius0: 1.0,withCollides: false,collide0: 0,withAccs: false,acc0: null,withInertias: false,inertia0: 1.0,this.intraCollide: false}):this.length=g,DG=new uC.Float32List(g*3),vB=withPrevious?new List.generate(g,(h)=>new q.fK()):null,color=withColors?new vJ(new List.generate(g,(h)=>color0)):new wJ(color0),kE=withMass?new vJ(new List.generate(g,(h)=>mass0)):new wJ(mass0),wB=withRadius?new vJ(new List.generate(g,(h)=>radius0)):new wJ(radius0),collide=withCollides?new vJ(new List.generate(g,(h)=>collide0)):new wJ(collide0),lF=withAccs?new vJ(new List.generate(g,(h)=>acc0==null?new q.fK():new q.gK(acc0))):new wJ(acc0==null?new q.fK():acc0),AG=withInertias?new vJ(new List.generate(g,(h)=>inertia0)):new wJ(inertia0){u=new List.generate(g,(h)=>new q.hK(new uC.Float32List.view(DG.buffer,h*4*3,3)));}eE(){for(int g=length-1;g>-1; --g){vB[g].FB(u[g]);}}}class UB{final  w;final  kB;final  lB;var collide=0;UB(this.w,this.kB,this.lB,[this.collide=0]);}typedef  GC( g, e, area);class DE extends JB{var nC=null;DE(this.nC);}class tJ extends tD{final  vM;final  wM;var xM;var yM;var zM=0;var AN=0;var BN=1.0;var CN=new HB(0.0,0.0);var OG=0.0;var PG=0.0;var DN=1.0;var EN=1.0;get scale=>DN/BN;set scale(g){DN=g*BN;EN=1/DN;}tJ(g):super(cB.zC([DE])),vM=g.context2D,wM=new DB.CanvasElement().context2D; initialize(){yM=new xC<DE>(DE,SB);xM=new xC<ZB>(ZB,SB);GN();} GN(){var g=vM.canvas;var h=scale;BN=DB.window.devicePixelRatio;scale=h;zM=(BN*g.clientWidth).round();AN=(BN*g.clientHeight).round();g.width=zM;g.height=AN;vM.scale(BN,BN);wM.canvas.width=zM;wM.canvas.height=AN;} UD(){wM.save();} kD( h){wM.translate(OG,PG);if(DN!=1.0)wM.scale(DN,DN);var j=yM.get(h);var g=xM.iE(h);if(g!=null){wM.translate(g.u.x.toInt(),g.u.y.toInt());wM.rotate(g.NC.z);wM.scale(g.sC.x,g.sC.y);}CN.x=0.0;CN.y=0.0;j.nC(wM,h,CN);if(g!=null){wM.scale(1/g.sC.x,1/g.sC.y);wM.rotate(-g.NC.z);wM.translate(-g.u.x.toInt(),-g.u.y.toInt());}if(DN!=1.0)wM.scale(EN,EN);wM.translate(-OG,-PG);wM.restore();} end(){wM.restore();vM.clearRect(0,0,zM,AN);vM.drawImage(wM.canvas,0,0);wM.clearRect(0,0,zM,AN);}} TF(h,j,{fillStyle,strokeStyle,strokeLineWidth: 1,strokeLineDashOffset: 0})=>( g, n,k){if(strokeStyle==null&&fillStyle==null)return;var l=-h/2;var m=-j/2;if(fillStyle!=null){g.fillStyle=fillStyle;g.fillRect(l,m,h,j);}if(strokeStyle!=null){g.strokeStyle=strokeStyle;g.lineWidth=strokeLineWidth;g.lineDashOffset=strokeLineDashOffset;g.strokeRect(l,m,h,j);}k.x=h.toDouble();k.y=j.toDouble();}; LH( h,{fillStyle,strokeStyle,strokeLineWidth: 1,strokeLineDashOffset: 0,textAlign: null,font: null})=>( g, j,k){if(strokeStyle==null&&fillStyle==null)return;if(fillStyle!=null){g.fillStyle=fillStyle;g.fillText(h,0,0);}if(strokeStyle!=null){g.strokeStyle=strokeStyle;g.lineWidth=strokeLineWidth;g.lineDashOffset=strokeLineDashOffset;if(font!=null)g.font=font;g.strokeText(h,0,0);}}; DD( t,{fillStyle,strokeStyle,strokeLineWidth: 1,strokeLineDashOffset: 0}){return ( g, s,v){var h=s.RB(CB.FC) as CB;if(h==null||h.u.isEmpty)return;for(var j=h.length-1;j>-1; --j){var l=h.u[j];if(l!=null){var n=h.wB[j]*t;var k=h.color[j];if(h.collide[j]==-1){k=LF(uG(KF(k)));}var m=BD(k);g.beginPath();g.arc(l.x,l.y,n,0,XC.PI*2,true);g.closePath();if(fillStyle!=null){g.fillStyle=m;g.fill();}if(strokeStyle!=null){g.strokeStyle=strokeStyle;g.lineWidth=strokeLineWidth;g.lineDashOffset=strokeLineDashOffset;g.stroke();}}}};}MH(g, h,m,l){var k=h.w.u[h.kB];var j=h.w.u[h.lB];g.beginPath();g.moveTo(k.x,k.y);g.lineTo(j.x,j.y);g.strokeStyle=(h.collide==-1)?l:m;g.stroke();}NH(g, h,j){g.beginPath();g.arc(h.jD.x,h.jD.y,6,0,2*XC.PI);g.fillStyle=j;g.fill();}OH(g, h,j){g.beginPath();g.moveTo(h.a.x,h.a.y);g.lineTo(h.b.x,h.b.y);g.lineTo(h.c.x,h.c.y);var k=g.lineWidth;g.lineWidth=5;g.strokeStyle=j;g.stroke();g.lineWidth=k;} PH({pinStyle: "rgba(0,153,255,0.1)",distanceStyle: "#d8dde2",distanceStyleCollide: "#e2ddd8",angleStyle: "rgba(255,255,0,0.2)"})=>( h, j,l){var k=j.RB(hB.FD) as hB;k.MB.forEach((g){if(distanceStyle!=null&&g is FE)MH(h,g.IB,distanceStyle,distanceStyleCollide);else if(pinStyle!=null&&g is UF)NH(h,g,pinStyle);else if(angleStyle!=null&&g is VF)OH(h,g,angleStyle);});};class QH{final  rF;final  nC;QH(this.rF,this.nC);} RH( j)=>( k, g,l){j.forEach((h){if(g.RB(h.rF)!=null){h.nC(k,g,l);}});};class ZB extends CF{static final ED=AC.BC(ZB);var u;var NC;var sC;var HN=new HB.fK(); get position{HN.x=u.x;HN.y=u.y;return HN;}ZB.aK();static SH()=>new ZB.aK();factory ZB.bK( j, g, h){return new ZB.cK(new q(j,g,0.0),new q(0.0,0.0,h));}factory ZB.cK( k,[ h, j]){var g=new DC.YK(ZB,SH) as ZB;g.u=k;g.NC=(h==null)?new q(0.0,0.0,0.0):h;g.sC=(j==null)?new q(1.0,1.0,1.0):j;return g;}}abstract class EE{nE( g);}class hB extends JB{static final FD=AC.BC(hB);final MB=new List<EE>();}class GD extends eG{var IN;var JN;var KN=new List<hB>(0);var LN=0;var steps=10;final cD=new q(0.0,0.0,0.0);var aB;final  interval;var MN=-1.0;GD({this.steps: 3,interval0: 1000.0/30, space0: null}):super(interval0,cB.zC([CB])),interval=interval0,aB=(space0!=null)?space0:new jJ(); initialize(){IN=new aF(CB,SB);JN=new aF(hB,SB);} mE( t){var m=new q.fK();var k=new q.fK();aB.reset();var s=tB.toDouble()/1000.0;var bB=(MN==-1)?s:MN;MN=s;var PC=(MN/bB);var QC=MN*MN;t.forEach((oB){var h=IN.get(oB);if(h==null)return;for(var g=h.length-1;g>-1; --g){var n=h.u[g];var AB=h.vB[g];m.FB(n).YB(AB).scale(PC*h.AG[g]);k.FB(cD);k.add(h.lF[g]);k.scale(QC);m.add(k);AB.FB(n);n.add(m);}aB.QD(h);});var TB=1.0/steps;NN(t);for(int v=0;v<steps; ++v){for(int g=0;g<LN;g++ ){var l=KN[g];l.MB.forEach((j){j.nE(TB);});}}for(var g=0;g<LN; ++g){var KB=KN[g];for(var j=0;j<KB.MB.length; ++j){var l=KB.MB[j];if(l is FE){aB.RD(l.IB);}}}aB.dD();}NN(g){LN=0;if(g.size>KN.length){KN=new List(g.size);}for(var h=0;h<g.size;h++ ){var k=g[h];var j=JN.iE(k);if(j!=null){KN[LN]=j;LN++ ;}}}}class FE implements EE{final  IB;var NG;var ON;var PN=new q.fK();FE(this.IB,this.NG){ON=(IB.w.u[IB.kB]-IB.w.u[IB.lB]).length;}factory FE.dK(k,g,l,h,[j=0]){return new FE(new UB(k,g,l,j),h);}nE(m){var h=IB.w.u[IB.kB];var l=IB.w.u[IB.lB];PN.FB(h).YB(l);var k=PN.length;var s=(ON-k)/k;PN.scale(s*NG*m);var g=IB.w.kE[IB.kB];var j=IB.w.kE[IB.lB];var n=(g+j);h.add(PN.scale(g/n));l.YB(PN.scale(j/g));}}class UF implements EE{final  jD;final  a;UF( g):jD=g.clone(),a=g;nE(g){a.FB(jD);}}class VF implements EE{} HD( n, m, h, KB, t, v){var AB=(2*XC.PI)/h;var j=v(h+1);for(var g=0;g<h; ++g){var s=g*AB;var k=j.u[g].FB(n);k.x=k.x+XC.cos(s)*m;k.y=k.y+XC.sin(s)*m;}j.u[h].FB(n);j.eE();var l=new hB();for(var g=0;g<h; ++g){l.MB.add(new FE.dK(j,g,(g+1)%h,t));l.MB.add(new FE.dK(j,g,h,KB));l.MB.add(new FE.dK(j,g,(g+5)%h,t));}return [j,l];} WF( l, k, m, n){var h=n(l.length);for(int g=0;g<h.length; ++g){h.u[g].FB(l[g]);}h.eE();var j=new hB();for(var g=1;g<h.u.length; ++g){j.MB.add(new FE.dK(h,g,g-1,k));}if(m){j.MB.add(new FE.dK(h,0,h.u.length-1,k));}return [h,j];} GE( g, h, j, l, k){return WF([g,g+h,g+h+j,g+j],l,true,k);} TH( QC, m, n, g, bB, AB, TB){var tC=m/g.toDouble();var KB=n/g.toDouble();var PC=m-n;var t=PC.length;var mD=AB*m.length/t;var s=AB*n.length/t;var k=TB(g*g);var l=new hB();for(var j=0;j<g; ++j){var v=k.u[j*g+0];v.FB(KB).scale(j.toDouble()).add(QC);if(j>0)l.MB.add(new FE.dK(k,j*g+0,(j-1)*g,s));for(var h=1;h<g; ++h){var oB=k.u[j*g+h];oB.FB(tC).scale(h.toDouble()).add(v);l.MB.add(new FE.dK(k,j*g+h,j*g+h-1,mD));if(j>0){l.MB.add(new FE.dK(k,j*g+h,(j-1)*g+h,s));}}}k.eE();for(var h=0;h<g; ++h){if(h%bB==0)XF(k.u[h],l);}return [k,l];}SC( g, h){XF((g.RB(CB.FC) as CB).u[h],g.RB(hB.FD));}XF( h, g){g.MB.add(new UF(h));}HC( h,j){(h.RB(hB.FD) as hB).MB.forEach((g){if(g is FE)g.IB.collide=j;});}class uJ<YF>{var QN=new ZF();get length{var h=0;for(var g=QN;g!=null;g=g.RN){if(g.SN!=null)h++ ;}return h;} clear(){for(var g=QN;g!=null;g=g.RN){g.SN=null;}} add( h){var g=QN;while (g!=null){if(g.SN==null){g.SN=h;return;}if(g.RN==null){var j=new ZF();j.SN=h;g.RN=j;return;}g=g.RN;}} uI( h(E)){var j=0;for(var g=QN;g!=null;g=g.RN){if(g.SN!=null){g.SN=h(g.SN);}}}}class ZF{var RN=null;var SN;}abstract class rB<ID>{ operator[]( g);operator[]=( h, g);}class vJ<ID> extends rB<ID>{final  TN;vJ(this.TN); operator[]( g)=>TN[g];operator[]=( h, g)=>TN[h]=g;}class wJ<ID> extends rB<ID>{final  UN;wJ(this.UN); operator[]( g)=>UN;operator[]=( h, g){}}OB(h, m,{ player, groups}){var g=h.fE();m.forEach((j)=>g.XE(j));if(groups!=null){var l=(h.zF(BF) as BF);groups.forEach((k)=>l.add(g,k));}if(player!=null){(h.zF(zE) as zE).OJ(g,player);}h.mF(g);return g;}class aF{var VN;var WN;aF( h, g){this.VN=AC.BC(h);WN=g.dE.yF(this.VN);}get( g)=>WN[g.id];iE( g){if(WN.jE(g.id)){return WN[g.id];}return null;}}class xJ{var min;var max;} UH( h, g, j){j.min.fB(h.x-g,h.y-g,h.z-g);j.max.fB(h.x+g,h.y+g,h.z+g);} VH( j, h, g, m){var k=m.min;var l=m.max;if(j.x<h.x){k.x=j.x-g;l.x=h.x+g;}else{k.x=h.x-g;l.x=j.x+g;}if(j.y<h.y){k.y=j.y-g;l.y=h.y+g;}else{k.y=h.y-g;l.y=j.y+g;}if(j.z<h.z){k.z=j.z-g;l.z=h.z+g;}else{k.z=h.z-g;l.z=j.z+g;}}abstract class bF{ KG( g, h, j, k); MG( h, g, k, j);}class yJ implements bF{var XN=new q.fK();var YN=new q.fK();var ZN=new q.fK();var aN=new xJ();var bN=new xJ(); KG( g, n, s, m){var k=XN;k.FB(s).YB(g);var h=YN;h.FB(n).YB(g);var v=h.gD;var j;if(v==0.0){j=g;}else{var l=(k.x*h.x+k.y*h.y)/v;j=(l<0.0)?g:(l>1.0)?n:h.scale(l).add(g);}var t=ZN;t.FB(s).YB(j);var AB=t.gD;if(AB>m*m)return false;return true;} MG( j, s, k, n){var g=s+n;var h=(j.x-k.x);var l=(j.y-k.y);var m=h*h+l*l;return (g*g>=m);}}var HE=false;var WH=LB.cF;class sB{final  name; get xF=>(parent==null||parent.name=='')?name:'${parent.xF}.${name}';final  parent;var cN;var children;var dN;var eN;factory sB( g){if(g.startsWith('.')){throw new ArgumentError("name shouldn't start with a '.'");}if(fC==null)fC=<String,sB>{};if(fC.containsKey(g))return fC[g];var k=g.lastIndexOf('.');var h=null;var j;if(k==-1){if(g!='')h=new sB('');j=g;}else{h=new sB(g.substring(0,k));j=g.substring(k+1);}final l=new sB.eK(j,h);fC[g]=l;return l;}sB.eK(this.name,this.parent):children=new Map<String,sB>(){if(parent!=null)parent.children[name]=this;} get pC{if(HE){if(cN!=null)return cN;if(parent!=null)return parent.pC;}return WH;} get zI=>fN(); tI( g)=>(g>=pC); log( j, l,[k]){if(tI(j)){var h=new gC(j,l,xF,k);if(HE){var g=this;while (g!=null){g.gN(h);g=g.parent;}}else{IE.gN(h);}}} info( h,[g])=>log(LB.cF,h,g); QG( h,[g])=>log(LB.XH,h,g); fN(){if(HE||parent==null){if(dN==null){dN=new qE.StreamController<gC>.broadcast(sync:true);eN=dN.stream;}return eN;}else{return IE.fN();}} gN( g){if(dN!=null){dN.add(g);}}static  get IE=>new sB('');static var fC;}class LB implements Comparable<LB>{final  name;final  value;const LB(this.name,this.value);static const  cF=const LB('INFO',800);static const  XH=const LB('WARNING',900); operator==( g)=>g!=null&&value==g.value; operator<( g)=>value<g.value; operator<=( g)=>value<=g.value; operator>( g)=>value>g.value; operator>=( g)=>value>=g.value; compareTo( g)=>value-g.value; get hashCode=>value; toString()=>name;}class gC{final  pC;final  message;final  vI;final  time;final  MJ;static var YH=0;var exception;gC(this.pC,this.message,this.vI,[this.exception]):time=new DateTime.now(),MJ=gC.YH++ ;}const zJ=const AK();class AK{const AK();}class dB{final  hN;final  iN; get min=>hN; get max=>iN;dB():hN=new q.fK(),iN=new q.fK(){} lI( h, g){h.FB(hN);h.add(iN);h.scale(0.5);g.FB(iN);g.YB(hN);g.scale(0.5);} rotate( j){var h=new q.fK();var g=new q.fK();lI(h,g);j.cI(g);hN.FB(h);iN.FB(h);hN.YB(g);iN.add(g);return this;} contains( g){return min.x<g.min.x&&min.y<g.min.y&&min.z<g.min.z&&max.x>g.max.x&&max.y>g.max.y&&max.z>g.max.z;}}class EB{final  i;EB( k, h, g, j):i=new uC.Float32List(4){fB(k,h,g,j);}EB.fK():i=new uC.Float32List(4);EB.gK( g):i=new uC.Float32List(4){FB(g);} fB( k, h, g, j){i[3]=j;i[2]=g;i[1]=h;i[0]=k;return this;} FB( g){i[3]=g.i[3];i[2]=g.i[2];i[1]=g.i[1];i[0]=g.i[0];return this;} toString()=>'${i[0]},${i[1]},' '${i[2]},${i[3]}'; operator-()=>new EB(-i[0],-i[1],-i[2],-i[3]); operator-( g)=>new EB(i[0]-g.i[0],i[1]-g.i[1],i[2]-g.i[2],i[3]-g.i[3]); operator+( g)=>new EB(i[0]+g.i[0],i[1]+g.i[1],i[2]+g.i[2],i[3]+g.i[3]); operator/( h){var g=1.0/h;return new EB(i[0]*g,i[1]*g,i[2]*g,i[3]*g);} operator*( h){var g=h;return new EB(i[0]*g,i[1]*g,i[2]*g,i[3]*g);} operator[]( g)=>i[g]; operator[]=( h, g){i[h]=g;} get length{var g;g=(i[0]*i[0]);g+= (i[1]*i[1]);g+= (i[2]*i[2]);g+= (i[3]*i[3]);return XC.sqrt(g);} get gD{var g;g=(i[0]*i[0]);g+= (i[1]*i[1]);g+= (i[2]*i[2]);g+= (i[3]*i[3]);return g;} get isNaN{var g=false;g=g||i[0].isNaN;g=g||i[1].isNaN;g=g||i[2].isNaN;g=g||i[3].isNaN;return g;} add( g){i[0]=i[0]+g.i[0];i[1]=i[1]+g.i[1];i[2]=i[2]+g.i[2];i[3]=i[3]+g.i[3];return this;} YB( g){i[0]=i[0]-g.i[0];i[1]=i[1]-g.i[1];i[2]=i[2]-g.i[2];i[3]=i[3]-g.i[3];return this;} scale( g){i[0]=i[0]*g;i[1]=i[1]*g;i[2]=i[2]*g;i[3]=i[3]*g;return this;} clone(){return new EB.gK(this);}set x( g)=>i[0]=g;set y( g)=>i[1]=g;set z( g)=>i[2]=g;set w( g){i[2]=g.i[0];i[0]=g.i[1];} get b=>i[2]; get a=>i[3]; get x=>i[0]; get y=>i[1]; get z=>i[2]; get OC=>i[3]; get lC=>new EB(i[3],i[3],i[2],i[2]); get w=>new HB(i[2],i[0]);}class q{final  i;q( j, h, g):i=new uC.Float32List(3){fB(j,h,g);}q.fK():i=new uC.Float32List(3);q.gK( g):i=new uC.Float32List(3){FB(g);}q.hK(this.i); fB( j, h, g){i[0]=j;i[1]=h;i[2]=g;return this;} FB( g){i[0]=g.i[0];i[1]=g.i[1];i[2]=g.i[2];return this;} toString()=>'[${i[0]},${i[1]},${i[2]}]'; operator-()=>new q(-i[0],-i[1],-i[2]); operator-( g)=>new q(i[0]-g.i[0],i[1]-g.i[1],i[2]-g.i[2]); operator+( g)=>new q(i[0]+g.i[0],i[1]+g.i[1],i[2]+g.i[2]); operator/( h){var g=1.0/h;return new q(i[0]*g,i[1]*g,i[2]*g);} operator*( h){var g=h;return new q(i[0]*g,i[1]*g,i[2]*g);} operator[]( g)=>i[g]; operator[]=( h, g){i[h]=g;} get length{var g;g=(i[0]*i[0]);g+= (i[1]*i[1]);g+= (i[2]*i[2]);return XC.sqrt(g);} get gD{var g;g=(i[0]*i[0]);g+= (i[1]*i[1]);g+= (i[2]*i[2]);return g;} get isNaN{var g=false;g=g||i[0].isNaN;g=g||i[1].isNaN;g=g||i[2].isNaN;return g;} add( g){i[0]=i[0]+g.i[0];i[1]=i[1]+g.i[1];i[2]=i[2]+g.i[2];return this;} YB( g){i[0]=i[0]-g.i[0];i[1]=i[1]-g.i[1];i[2]=i[2]-g.i[2];return this;} scale( g){i[2]=i[2]*g;i[1]=i[1]*g;i[0]=i[0]*g;return this;} clone(){return new q.gK(this);}set x( g)=>i[0]=g;set y( g)=>i[1]=g;set z( g)=>i[2]=g;set w( g){i[2]=g.i[0];i[0]=g.i[1];} get b=>i[2]; get x=>i[0]; get y=>i[1]; get z=>i[2]; get w=>new HB(i[2],i[0]);}class HB{final  i;HB( h, g):i=new uC.Float32List(2){fB(h,g);}HB.fK():i=new uC.Float32List(2);HB.gK( g):i=new uC.Float32List(2){FB(g);} fB( h, g){i[0]=h;i[1]=g;return this;} FB( g){i[1]=g.i[1];i[0]=g.i[0];return this;} toString()=>'[${i[0]},${i[1]}]'; operator-()=>new HB(-i[0],-i[1]); operator-( g)=>new HB(i[0]-g.i[0],i[1]-g.i[1]); operator+( g)=>new HB(i[0]+g.i[0],i[1]+g.i[1]); operator/( h){var g=1.0/h;return new HB(i[0]*g,i[1]*g);} operator*( h){var g=h;return new HB(i[0]*g,i[1]*g);} operator[]( g)=>i[g]; operator[]=( h, g){i[h]=g;} get length{var g;g=(i[0]*i[0]);g+= (i[1]*i[1]);return XC.sqrt(g);} get gD{var g;g=(i[0]*i[0]);g+= (i[1]*i[1]);return g;} get isNaN{var g=false;g=g||i[0].isNaN;g=g||i[1].isNaN;return g;} add( g){i[0]=i[0]+g.i[0];i[1]=i[1]+g.i[1];return this;} YB( g){i[0]=i[0]-g.i[0];i[1]=i[1]-g.i[1];return this;} scale( g){i[1]=i[1]*g;i[0]=i[0]*g;return this;} clone(){return new HB.gK(this);}set x( g)=>i[0]=g;set y( g)=>i[1]=g; get x=>i[0]; get y=>i[1];}class GB{final  i=new uC.Float32List(16); index( g, h)=>(h*4)+g; entry( g, h)=>i[index(g,h)];GB.fK();GB.iK(){NJ();}GB.gK( g){FB(g);} FB( g){i[15]=g.i[15];i[14]=g.i[14];i[13]=g.i[13];i[12]=g.i[12];i[11]=g.i[11];i[10]=g.i[10];i[9]=g.i[9];i[8]=g.i[8];i[7]=g.i[7];i[6]=g.i[6];i[5]=g.i[5];i[4]=g.i[4];i[3]=g.i[3];i[2]=g.i[2];i[1]=g.i[1];i[0]=g.i[0];return this;} toString(){var g='';g='${g}[0] ${aD(0)}\n';g='${g}[1] ${aD(1)}\n';g='${g}[2] ${aD(2)}\n';g='${g}[3] ${aD(3)}\n';return g;} get pI=>4; operator[]( g)=>i[g]; operator[]=( h, g){i[h]=g;} aD( h){var g=new EB.fK();g.i[0]=i[index(h,0)];g.i[1]=i[index(h,1)];g.i[2]=i[index(h,2)];g.i[3]=i[index(h,3)];return g;} clone(){return new GB.gK(this);} jN( h){var g=new GB.fK();g.i[15]=i[15]*h;g.i[14]=i[14]*h;g.i[13]=i[13]*h;g.i[12]=i[12]*h;g.i[11]=i[11]*h;g.i[10]=i[10]*h;g.i[9]=i[9]*h;g.i[8]=i[8]*h;g.i[7]=i[7]*h;g.i[6]=i[6]*h;g.i[5]=i[5]*h;g.i[4]=i[4]*h;g.i[3]=i[3]*h;g.i[2]=i[2]*h;g.i[1]=i[1]*h;g.i[0]=i[0]*h;return g;} kN( g){var h=new GB.fK();h.i[0]=(i[0]*g.i[0])+(i[4]*g.i[1])+(i[8]*g.i[2])+(i[12]*g.i[3]);h.i[4]=(i[0]*g.i[4])+(i[4]*g.i[5])+(i[8]*g.i[6])+(i[12]*g.i[7]);h.i[8]=(i[0]*g.i[8])+(i[4]*g.i[9])+(i[8]*g.i[10])+(i[12]*g.i[11]);h.i[12]=(i[0]*g.i[12])+(i[4]*g.i[13])+(i[8]*g.i[14])+(i[12]*g.i[15]);h.i[1]=(i[1]*g.i[0])+(i[5]*g.i[1])+(i[9]*g.i[2])+(i[13]*g.i[3]);h.i[5]=(i[1]*g.i[4])+(i[5]*g.i[5])+(i[9]*g.i[6])+(i[13]*g.i[7]);h.i[9]=(i[1]*g.i[8])+(i[5]*g.i[9])+(i[9]*g.i[10])+(i[13]*g.i[11]);h.i[13]=(i[1]*g.i[12])+(i[5]*g.i[13])+(i[9]*g.i[14])+(i[13]*g.i[15]);h.i[2]=(i[2]*g.i[0])+(i[6]*g.i[1])+(i[10]*g.i[2])+(i[14]*g.i[3]);h.i[6]=(i[2]*g.i[4])+(i[6]*g.i[5])+(i[10]*g.i[6])+(i[14]*g.i[7]);h.i[10]=(i[2]*g.i[8])+(i[6]*g.i[9])+(i[10]*g.i[10])+(i[14]*g.i[11]);h.i[14]=(i[2]*g.i[12])+(i[6]*g.i[13])+(i[10]*g.i[14])+(i[14]*g.i[15]);h.i[3]=(i[3]*g.i[0])+(i[7]*g.i[1])+(i[11]*g.i[2])+(i[15]*g.i[3]);h.i[7]=(i[3]*g.i[4])+(i[7]*g.i[5])+(i[11]*g.i[6])+(i[15]*g.i[7]);h.i[11]=(i[3]*g.i[8])+(i[7]*g.i[9])+(i[11]*g.i[10])+(i[15]*g.i[11]);h.i[15]=(i[3]*g.i[12])+(i[7]*g.i[13])+(i[11]*g.i[14])+(i[15]*g.i[15]);return h;} lN( g){var h=new EB.fK();h.i[3]=(i[3]*g.i[0])+(i[7]*g.i[1])+(i[11]*g.i[2])+(i[15]*g.i[3]);h.i[2]=(i[2]*g.i[0])+(i[6]*g.i[1])+(i[10]*g.i[2])+(i[14]*g.i[3]);h.i[1]=(i[1]*g.i[0])+(i[5]*g.i[1])+(i[9]*g.i[2])+(i[13]*g.i[3]);h.i[0]=(i[0]*g.i[0])+(i[4]*g.i[1])+(i[8]*g.i[2])+(i[12]*g.i[3]);return h;} mN( g){var h=new q.fK();h.i[0]=(i[0]*g.i[0])+(i[4]*g.i[1])+(i[8]*g.i[2])+i[12];h.i[1]=(i[1]*g.i[0])+(i[5]*g.i[1])+(i[9]*g.i[2])+i[13];h.i[2]=(i[2]*g.i[0])+(i[6]*g.i[1])+(i[10]*g.i[2])+i[14];return h;} operator*( g){if(g is double){return jN(g);}if(g is EB){return lN(g);}if(g is q){return mN(g);}if(4==g.pI){return kN(g);}throw new ArgumentError(g);} operator+( h){var g=new GB.fK();g.i[0]=i[0]+h.i[0];g.i[1]=i[1]+h.i[1];g.i[2]=i[2]+h.i[2];g.i[3]=i[3]+h.i[3];g.i[4]=i[4]+h.i[4];g.i[5]=i[5]+h.i[5];g.i[6]=i[6]+h.i[6];g.i[7]=i[7]+h.i[7];g.i[8]=i[8]+h.i[8];g.i[9]=i[9]+h.i[9];g.i[10]=i[10]+h.i[10];g.i[11]=i[11]+h.i[11];g.i[12]=i[12]+h.i[12];g.i[13]=i[13]+h.i[13];g.i[14]=i[14]+h.i[14];g.i[15]=i[15]+h.i[15];return g;} operator-( h){var g=new GB.fK();g.i[0]=i[0]-h.i[0];g.i[1]=i[1]-h.i[1];g.i[2]=i[2]-h.i[2];g.i[3]=i[3]-h.i[3];g.i[4]=i[4]-h.i[4];g.i[5]=i[5]-h.i[5];g.i[6]=i[6]-h.i[6];g.i[7]=i[7]-h.i[7];g.i[8]=i[8]-h.i[8];g.i[9]=i[9]-h.i[9];g.i[10]=i[10]-h.i[10];g.i[11]=i[11]-h.i[11];g.i[12]=i[12]-h.i[12];g.i[13]=i[13]-h.i[13];g.i[14]=i[14]-h.i[14];g.i[15]=i[15]-h.i[15];return g;} translate( g,[ t=0.0, AB=0.0]){var h;var k;var j;var l=g is EB?g.OC:1.0;if(g is q||g is EB){h=g.x;k=g.y;j=g.z;}else{h=g;k=t;j=AB;}var s=i[0]*h+i[4]*k+i[8]*j+i[12]*l;var v=i[1]*h+i[5]*k+i[9]*j+i[13]*l;var m=i[2]*h+i[6]*k+i[10]*j+i[14]*l;var n=i[3]*h+i[7]*k+i[11]*j+i[15]*l;i[12]=s;i[13]=v;i[14]=m;i[15]=n;return this;} JJ( j){var h=XC.cos(j);var g=XC.sin(j);var s=i[4]*h+i[8]*g;var t=i[5]*h+i[9]*g;var k=i[6]*h+i[10]*g;var m=i[7]*h+i[11]*g;var v=i[4]*-g+i[8]*h;var AB=i[5]*-g+i[9]*h;var l=i[6]*-g+i[10]*h;var n=i[7]*-g+i[11]*h;i[4]=s;i[5]=t;i[6]=k;i[7]=m;i[8]=v;i[9]=AB;i[10]=l;i[11]=n;return this;} KJ( j){var h=XC.cos(j);var g=XC.sin(j);var s=i[0]*h+i[8]*g;var t=i[1]*h+i[9]*g;var k=i[2]*h+i[10]*g;var m=i[3]*h+i[11]*g;var v=i[0]*-g+i[8]*h;var AB=i[1]*-g+i[9]*h;var l=i[2]*-g+i[10]*h;var n=i[3]*-g+i[11]*h;i[0]=s;i[1]=t;i[2]=k;i[3]=m;i[8]=v;i[9]=AB;i[10]=l;i[11]=n;return this;} LJ( j){var h=XC.cos(j);var g=XC.sin(j);var s=i[0]*h+i[4]*g;var t=i[1]*h+i[5]*g;var k=i[2]*h+i[6]*g;var m=i[3]*h+i[7]*g;var v=i[0]*-g+i[4]*h;var AB=i[1]*-g+i[5]*h;var l=i[2]*-g+i[6]*h;var n=i[3]*-g+i[7]*h;i[0]=s;i[1]=t;i[2]=k;i[3]=m;i[4]=v;i[5]=AB;i[6]=l;i[7]=n;return this;} scale( g,[ m=null, n=null]){var k;var h;var j;var l=g is EB?g.OC:1.0;if(g is q||g is EB){k=g.x;h=g.y;j=g.z;}else{k=g;h=m==null?g:m.toDouble();j=n==null?g:n.toDouble();}i[0]*=k;i[1]*=k;i[2]*=k;i[3]*=k;i[4]*=h;i[5]*=h;i[6]*=h;i[7]*=h;i[8]*=j;i[9]*=j;i[10]*=j;i[11]*=j;i[12]*=l;i[13]*=l;i[14]*=l;i[15]*=l;return this;} operator-(){var g=new GB.fK();g[0]=-i[0];g[1]=-i[1];g[2]=-i[2];g[3]=-i[3];return g;} NJ(){i[0]=1.0;i[1]=0.0;i[2]=0.0;i[3]=0.0;i[4]=0.0;i[5]=1.0;i[6]=0.0;i[7]=0.0;i[8]=0.0;i[9]=0.0;i[10]=1.0;i[11]=0.0;i[12]=0.0;i[13]=0.0;i[14]=0.0;i[15]=1.0;return this;} cI( g){var s=i[0].abs();var l=i[4].abs();var KB=i[8].abs();var t=i[1].abs();var n=i[5].abs();var TB=i[9].abs();var m=i[2].abs();var AB=i[6].abs();var v=i[10].abs();var h=g.x;var j=g.y;var k=g.z;g.x=h*s+j*l+k*KB+0.0*0.0;g.y=h*t+j*n+k*TB+0.0*0.0;g.z=h*m+j*AB+k*v+0.0*0.0;return g;} add( g){i[0]=i[0]+g.i[0];i[1]=i[1]+g.i[1];i[2]=i[2]+g.i[2];i[3]=i[3]+g.i[3];i[4]=i[4]+g.i[4];i[5]=i[5]+g.i[5];i[6]=i[6]+g.i[6];i[7]=i[7]+g.i[7];i[8]=i[8]+g.i[8];i[9]=i[9]+g.i[9];i[10]=i[10]+g.i[10];i[11]=i[11]+g.i[11];i[12]=i[12]+g.i[12];i[13]=i[13]+g.i[13];i[14]=i[14]+g.i[14];i[15]=i[15]+g.i[15];return this;} YB( g){i[0]=i[0]-g.i[0];i[1]=i[1]-g.i[1];i[2]=i[2]-g.i[2];i[3]=i[3]-g.i[3];i[4]=i[4]-g.i[4];i[5]=i[5]-g.i[5];i[6]=i[6]-g.i[6];i[7]=i[7]-g.i[7];i[8]=i[8]-g.i[8];i[9]=i[9]-g.i[9];i[10]=i[10]-g.i[10];i[11]=i[11]-g.i[11];i[12]=i[12]-g.i[12];i[13]=i[13]-g.i[13];i[14]=i[14]-g.i[14];i[15]=i[15]-g.i[15];return this;} IJ( g){var k=(i[0]*g.i[0])+(i[4]*g.i[1])+(i[8]*g.i[2]);var j=(i[1]*g.i[0])+(i[5]*g.i[1])+(i[9]*g.i[2]);var h=(i[2]*g.i[0])+(i[6]*g.i[1])+(i[10]*g.i[2]);g.x=k;g.y=j;g.z=h;return g;} get right{var h=i[0];var g=i[1];var j=i[2];return new q(h,g,j);}}const BK=const CK();typedef  eB( e);typedef  ZH( changes);typedef  XB();typedef  aH();class JD{final oldValue;final newValue;final  changes;JD(this.oldValue,this.newValue,[this.changes]); operator==(g){return g is JD&&oldValue==g.oldValue&&newValue==g.newValue&&changes==g.changes;} get hashCode=>rH(oldValue,newValue,changes); toString(){if(changes!=null)return '#<ChangeNotification to ${newValue}: ${changes}>';return '#<ChangeNotification from ${oldValue} to ${newValue}>';}}class iB{static const JE=1;static const KE=2;static const dF=KE|4;static const eF=KE|8;final  type;final key;final oldValue;final newValue;iB(this.type,this.key,this.oldValue,this.newValue); operator==(g){return g is iB&&type==g.type&&key==g.key&&oldValue==g.oldValue&&newValue==g.newValue;} get hashCode=>sH(type,key,oldValue,newValue); toString(){var g;switch (type){case JE:g='field';break;case KE:g='index';break;case dF:g='insert';break;case eF:g='remove';break;}return '#<ChangeRecord ${g} ${key} from ${oldValue} to ${newValue}>';}} bH(g, j,[ l]){if(g is PB){var h=g;return LE(h,(m){j(new JD(h,h,m));});}var k=new KD(g,j,l);if(!k.nN()){return hH;}return k.oN;} LE( g, j){if(g.VC==null)g.VC=new ME();var h=g.VC.add(j);return h.remove;}class PB{var VC;var UC;final  hashCode= ++PB.cH;static var cH=0;} dH( g)=>g.VC!=null&&g.VC.head!=null; get eH=>TC!=null; fH( g, h,j)=>TC.pN(g,h,j); gH( g, k,l, h, j){if((k&(iB.dF|iB.eF))==0){if(h==j)return;}if(IC==null){IC=[] ;tH(iH);}if(g.UC==null){g.UC=[] ;IC.add(g);}g.UC.add(new iB(k,l,h,j));} hH(){}var TC;var fF=100;var IC;var JC; iH(){var m=0;while (IC!=null||JC!=null){var k=IC;IC=null;var j=JC;JC=null;if(m++ ==fF){jH(k,j);return;}if(k!=null){for(var h in k){var s=h.UC;h.UC=null;for(var g=h.VC.head;g!=null;g=g.next){var l=g.value;try {l(s);}catch (t,n){hC(t,n,l,'from ${h}');}}}}if(j!=null){j.forEach((AB,v){v.qN();});}}} jH( l, k){var g=[] ;if(l!=null){for(var j in l){var s=j.UC;g.add('${j} ${s}');}}if(k!=null){for(var m in k.values){var h=m.qN();if(h!=null)g.add('${m} ${h}');}}IC=null;JC=null;var n='exceeded notifiction limit of ${fF}, possible ' 'circular reference in observer callbacks: ${g.take(10).join(", ")}';mH(n);}class KD{static var kH=0;final  rN= ++KD.kH;final  sN;final  tN;final  uN;final  vN=new Map();final  wN=[] ;var xN=false;var yN;KD(this.sN,this.tN,this.uN); toString()=>uN!=null?'<observer ${rN}: ${uN}>':'<observer ${rN}>'; nN(){var h=TC;TC=this;try {yN=sN();if(yN is Iterable&&yN is !List&&yN is !PB){yN=(yN as Iterable).toList();}}catch (g,j){hC(g,j,sN,'from ${this}');yN=null;}vN.forEach(zN);vN.clear();assert(TC==this);TC=h;AO();return wN.length>0;} BO( j){try {tN(j);}catch (g,h){hC(g,h,tN,'from ${this}');}} AO(){var g=yN;if(g is !PB)return;wN.add(LE(g,(h){BO(new JD(g,g,h));}));} pN( m, n,g){var j=vN.putIfAbsent(m,()=>new Map());try {var h=j[g];if(h==null)h=0;j[g]=h|n;}catch (k,l){hC(k,l,g,'hashCode or operator == from ${this}');}} zN( j, k){wN.add(LE(j,(l){if(xN)return;for(var g in l){var h=k[g.key];if(h!=null&&(h&g.type)!=0){xN=true;if(JC==null){JC=new rE.SplayTreeMap();}JC[rN]=this;return;}}}));} oN(){for(var g in wN){g();}xN=false;} qN(){if(!xN)return null;var g=yN;oN();nN();try {if(g==yN)return null;}catch (j,k){hC(j,k,g,'operator == from ${this}');return null;}var h=new JD(g,yN);BO(h);return h;}}typedef  lH( message);var mH=(g)=>print(g);typedef  nH(error,stackTrace,obj, message);var hC=oH; oH(j,g,h, k){print('web_ui.observe: unhandled error calling ${h} ${k}.\n' 'error:\n${j}\n\nstack trace:\n${g}');}class CK{const CK();}class pH{}class qH{}class VB<WB>{var CO;var DO;var EO;var FO;VB.jK( g,this.EO):FO=g{if(EO!=null)EO.GO++ ;} get next=>DO; get value=>FO;set value( g)=>FO=g; HO( g, h){DO=h;CO=g;if(g!=null)g.DO=this;if(h!=null)h.CO=this;return this;} append( g)=>new VB<WB>.jK(g,EO).HO(this,DO); remove(){if(EO==null)return;EO.GO-- ;if(CO!=null){CO.DO=DO;}else{EO.IO=DO;}if(DO!=null){DO.CO=CO;}else{EO.JO=CO;}DO=null;CO=null;EO=null;}}class ME<WB> extends rE.IterableBase<WB>{var IO;var JO; get length=>GO;var GO=0;ME(){} get head=>IO; add( h){var g=new VB<WB>.jK(h,this);if(JO==null)return IO=JO=g;return JO=g.HO(JO,null);} addLast( g)=>add(g); addAll( g)=>g.forEach(add); get iterator=>new DK<WB>(this);}class DK<WB> implements Iterator<WB>{var KO;var EO;var LO;var MO=-1;DK(this.EO){KO=new List<VB>(EO.length);var h=0;var g=EO.head;while (g!=null){KO[h++ ]=g;g=g.next;}} get current=>LO; moveNext(){do{MO++ ;}while(MO<KO.length&&KO[MO].EO!=EO);if(MO<KO.length){LO=KO[MO].value;return true;}else{LO=null;return false;}}}iC(h,g)=>h.hashCode*31+g.hashCode;rH(h,g,j)=>iC(iC(h,g),j);sH(g,j,h,k)=>iC(iC(g,j),iC(h,k)); tH( h()){var g=new VK.ReceivePort();g.receive((j,k){g.close();h();});g.toSendPort().send(null);} uH(j, g,[ h]){var k=j is pH;if(h==null){h=j.toString();}if(!k&&g is DB.Text){g.text=h;}else{var l=g;g=k?new DB.Element.html(h):new DB.Text(h);l.replaceWith(g);}return g;} NE( h, k,g){if(g==''||g==null)return;if(k){if(g is String){if(g.contains(' ')){h.classes.addAll(g.split(' '));}else{h.classes.add(g);}}else if(g is List<String>){h.classes.addAll(g.where((j)=>j!=null&&j!=''));}else{throw new ArgumentError('classes must be a String or List<String>.');}}else{if(g is String){if(g.contains(' ')){h.classes.removeAll(g.split(' '));}else{h.classes.remove(g);}}else if(g is List<String>){h.classes.removeAll(g.where((j)=>j!=null&&j!=''));}else{throw new ArgumentError('classes must be a String or List<String>.');}}} vH(h, g){if(g.oldValue!=null)h.classes.remove(g.oldValue);if(g.newValue!=null)h.classes.add(g.newValue);} wH( h, j(),[ l]){return OD(j,(g){if(g.changes!=null){for(var k in g.changes)vH(h,k);}else{NE(h,false,g.oldValue);NE(h,true,g.newValue);}},'css-class-bind',l);} xH(g){if(g is qH)return g.toString();g=g.toString();return zH(g)?g:'#';}const yH=const["http","https","ftp","mailto"]; zH( h){var g=Uri.parse(h).scheme;if(g=='')return true;return yH.contains(g.toLowerCase())||"MAILTO"==g.toUpperCase();}abstract class LD{ KC(){} insert(); remove();}abstract class OE extends LD{final exp;final  isFinal;final  YD;var xB;OE(this.exp,this.isFinal):YD=QE&&MD!=null?MD():null; insert(){if(isFinal){fD();}else if(xB!=null){throw new StateError('binding already attached');}else{xB=lD();}} remove(){if(!isFinal){xB();xB=null;}} fD(); lD();}class EK extends OE{final  action;EK(g,this.action, h):super(g,h); fD()=>action(new JD(null,exp())); lD()=>OD(exp,action,'generic-binding',YD);}class FK extends OE{final  hE;FK(this.hE,g, h):super(g,h); fD()=>NE(hE,true,exp()); lD()=>wH(hE,exp,YD);}class GK extends OE{final  LG;final  BG;GK( g,this.LG,this.BG, h):super(g,h); NO(g){LG(BG?xH(g):g);} fD()=>NO(exp()); lD()=>OD(exp,(g)=>NO(g.newValue),'dom-property-binding',YD);}class HK extends LD{final WC;HK(this.WC); KC(){WC..nI()..mI()..jI();} insert(){WC..eD()..sI();} remove(){WC..HJ()..oE();}}class PE extends LD{final  lE;final  children=[] ;final  nodes=[] ;PE(this.lE); kI( h,j){var g=new DB.Text('');children.add(new EK(()=>'${h()}',(k){g=uH(h(),g,k.newValue);},j));return g;} fI(h,g,j){children.add(new FK(h,g,j));} CJ(g,k,h,[j=false]){children.add(new GK(g,k,j,h));} loop( h,g,j){children.add(new IK(h,g,j));} WC( g){children.add(new HK(g));} add( g)=>nodes.add(g); addAll( g)=>nodes.addAll(g); KC(){for(var g=0,h=children.length;g<h;g++ ){children[g].KC();}} insert(){for(var g=0,h=children.length;g<h;g++ ){children[g].insert();}} remove(){for(var g=children.length-1;g>=0;g-- ){children[g].remove();}children.clear();}}abstract class AI extends PE{final exp;var xB;AI( g,this.exp):super(g); KC(){} insert(){super.KC();if(nodes.length>0){var j=lE.parentNode;var k=lE.nextNode;for(var g=0,h=nodes.length;g<h;g++ ){j.insertBefore(nodes[g],k);}}super.insert();} remove(){super.remove();for(var g=nodes.length-1;g>=0;g-- ){nodes[g].remove();}nodes.clear();}}typedef  BI( list, index, template);class IK extends AI{final  CG;IK( h,g,this.CG):super(h,g); insert(){xB=OD(exp,(j){super.remove();var h=j.newValue;for(int g=0;g<h.length;g++ ){CG(h,g,this);}super.insert();},'loop-binding');} remove(){super.remove();xB();xB=null;}}var gF=false;var QE=false;var MD=(){try {throw "";}catch (h,g){return g.toString();}};final  ND=new sB('watcher'); CI(g, n,[ k, m]){if(gF)return bH(g,n);if(n==null)return (){};if(RE==null)RE=new ME<jC>();k=k==null?'<unnamed>':k;var j;var h=QB.HI;if(g is iF){j=(g as iF).OO;}else if(g is Function){j=g;try {var l=g();if(l is List){h=QB.kC;}else if(l is Iterable){h=QB.kC;j=()=>g().toList();}else if((l is rE.LinkedHashMap)||(l is rE.SplayTreeMap)){h=QB.TE;}else if(l is Map){h=QB.SE;}}catch (s,v){ND.QG('evaluating ${k} watcher threw error (${s}, ${v})');}}else if(g is List){j=()=>g;h=QB.kC;}else if(g is Iterable){j=()=>g.toList();h=QB.kC;}else if((g is rE.LinkedHashMap)||(g is rE.SplayTreeMap)){j=()=>g;h=QB.TE;}else if(g is Map){j=()=>g;h=QB.SE;}if(QE&&m==null&&MD!=null){m=MD();}var AB=DI(h,j,n,k,m);var t=RE.add(AB);return t.remove;} DI( l, g, k, h, j){switch (l){case QB.kC:return new JK(g,k,h,j);case QB.TE:return new NK(g,k,h,j);case QB.SE:return new KK(g,k,h,j);default:return new jC(g,k,h,j);}} OD(h, j,[ k, l]){var m=CI(h,j,k,l);var g=h;if(g is Function){g=g();}if(g is Iterable&&g is !List){g=g.toList();}j(new JD(null,g));return m;}var RE;class jC{final  sF;var location;final  PO;static var EI=0;final  OO;final  QO;var RO;jC(this.OO,this.QO,this.sF,this.location):PO=EI++ {RO=OO();} toString()=>'${sF} (id: #${PO})'; SO(g){if(QE){if(location!=null){ND.info('watcher updated: ${this}, defined at:\n${location}');location=null;}else{ND.info('watcher updated: ${this}');}}RO=g;}TO(){try {return OO();}catch (g,h){ND.QG('${this} watcher threw an exception: ${g}, ${h}');}return RO;}}typedef  hF<FI>();typedef  GI<FI>( value);class iF<FI>{}class JK<FI> extends jC{JK(g, k, h, j):super(g,k,h,j){SO(TO());} SO(g){RO=new List<FI>.from(g);}}class KK<LK,MK> extends jC{KK(g, k, h, j):super(g,k,h,j){SO(TO());} SO(g){RO=new Map<LK,MK>.from(g);}}class NK<LK,MK> extends jC{NK(g, k, h, j):super(g,k,h,j){SO(TO());} SO(g){RO=new rE.LinkedHashMap.from(g);}}class QB{final UO;const QB.kK(this.UO);toString()=>'Enum.${UO}';static const kC=const QB.kK('LIST');static const SE=const QB.kK('HASH_MAP');static const TE=const QB.kK('ORDERED_MAP');static const HI=const QB.kK('OTHER');}abstract class jF implements DB.Element{var VO;var WO;var XO={};var YO=new WE({}); rI( g)=>YO; PJ( h,var g){YO=g;} get host{if(VO==null)throw new StateError('host element has not been set.');return VO;}set host( g){if(g==null){throw new ArgumentError('host must not be null.');}var h=g.xtag;if(h!=null&&h!=g){throw new ArgumentError('host must not have its xtag property set.');}if(VO!=null){throw new StateError('host can only be set once.');}g.xtag=this;VO=g;}createShadowRoot([ g]){var h=ZO();if(g!=null){XO[g]=h;}return h;}ZO(){if(kF){return host.createShadowRoot();}if(WO==null)WO=[] ;WO.add(new DB.DivElement());return WO.last;} mI(){} eD(){} oE(){} jI(){if(kF)return;if(WO.length==0){throw new StateError('Distribution algorithm requires at least one shadow' ' root and can only be run once.');}var k=WO;var g=k.removeLast();var n=g;var m=new List.from(nodes);var l=[] ;var s=[] ;while (true){m=aO(g,m);var h=g.query('shadow');if(h!=null){if(k.length>0){g=k.removeLast();l.add(h);s.add(g);}else{VE(h,m);break;}}else{break;}}for(int j=0;j<l.length;j++ ){var h=l[j];var g=s[j];VE(h,g.nodes);}nodes.clear();nodes.addAll(n.nodes);for(var t in XO.keys){if(XO[t]==n){XO[t]=this;break;}}} aO( n, k){for(var g in n.queryAll('content')){if(!JI(g))continue;var j=g.attributes['select'];if(j==null||j=='')j='*';var h=[] ;var m=[] ;for(var l in k){(II(l,j)?h:m).add(l);}if(h.length==0){h=g.nodes;}VE(g,h);k=m;}return k;}static  II( h, g){if(h is !DB.Element)return g=='*';return (h as DB.Element).matches(g);}static  UE( g)=>g.tagName=='CONTENT'||g.tagName=='SHADOW';static  JI( g){assert(UE(g));for(g=g.parent;g!=null;g=g.parent){if(UE(g))return false;}return true;}static  VE( g, h){assert(UE(g));g.parent.insertAllBefore(h,g);g.remove();} get nodes=>host.nodes; replaceWith( g){host.replaceWith(g);} remove()=>host.remove(); get nextNode=>host.nextNode;set text( g){host.text=g;} contains( g)=>host.contains(g); insertBefore( g, h)=>host.insertBefore(g,h); insertAllBefore( g, h)=>host.insertAllBefore(g,h); get attributes=>host.attributes; get children=>host.children; get classes=>host.classes; clone( g)=>host.clone(g); get parent=>host.parent; get parentNode=>host.parentNode; get nodeValue=>host.nodeValue; get id=>host.id;set id( g){host.id=g;} set innerHtml( g){host.innerHtml=g;} get translate=>host.translate; get tagName=>host.tagName; matches( g)=>host.matches(g); query( g)=>host.query(g); queryAll( g)=>host.queryAll(g); get OI=>host.OI; get className=>host.className;set className( g){host.className=g;} get clientHeight=>client.height; get clientLeft=>client.left; get clientTop=>client.top; get clientWidth=>client.width; get client=>host.client; get QI=>host.QI; get TI=>host.TI; RI( g)=>host.RI(g); SI( g)=>host.SI(g); WI( g)=>host.WI(g); XI( g)=>host.XI(g); bI( h, g)=>host.bI(h,g);get MI=>host.MI; get NI=>host.NI; get firstChild=>host.firstChild; get localName=>host.localName; get UI=>host.UI; get VI=>host.VI; LI( j, g,[ h]){host.LI(j,g,h);} YI( g)=>host.YI(g); ZI( j, g,[ h]){host.ZI(j,g,h);} aI( g, h)=>host.aI(g,h);get xtag=>host.xtag;set xtag(g){host.xtag=g;} append( g)=>host.append(g);}class WE{final  bO;WE(this.bO); operator[]( g)=>bO[g];}var KI=false; get kF=>KI&&DB.ShadowRoot.supported;//@ sourceMappingURL=_demos_bootstrap.dart.map
