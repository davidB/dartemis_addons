        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>World class / dartemis Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="dartemis" data-type="World">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../dartemis.html">dartemis</a> &rsaquo; <a href="../dartemis/World.html">World</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>World</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>The primary instance for the framework. It contains all the managers.</p>
<p>You must use this to create, delete and retrieve entities.</p>
<p>It is also important to set the delta each game loop iteration, and initialize before game loop.</p>
<pre class="source">
class World {
 final EntityManager _entityManager = new EntityManager();
 final ComponentManager _componentManager = new ComponentManager();

 final Bag&lt;Entity&gt; _added = new Bag&lt;Entity&gt;();
 final Bag&lt;Entity&gt; _changed = new Bag&lt;Entity&gt;();
 final Bag&lt;Entity&gt; _deleted = new Bag&lt;Entity&gt;();
 final Bag&lt;Entity&gt; _enable = new Bag&lt;Entity&gt;();
 final Bag&lt;Entity&gt; _disable = new Bag&lt;Entity&gt;();

 final Map&lt;Type, EntitySystem&gt; _systems = new Map&lt;Type, EntitySystem&gt;();
 final List&lt;EntitySystem&gt; _systemsList= new List&lt;EntitySystem&gt;();

 final Map&lt;Type, Manager&gt; _managers = new Map&lt;Type, Manager&gt;();
 final Bag&lt;Manager&gt; _managersBag = new Bag&lt;Manager&gt;();

 num delta;

 World() {
   addManager(_entityManager);
   addManager(_componentManager);
 }

 /**
  * Makes sure all managers systems are initialized in the order they were
  * added.
  */
 void initialize() {
   _managersBag.forEach((manager) =&gt; manager.initialize());
   _systemsList.forEach((system) =&gt; system.initialize());
 }

 /**
  * Returns a manager that takes care of all the entities in the world.
  * entities of this world.
  */
 EntityManager get entityManager =&gt; _entityManager;

 /**
  * Returns a manager that takes care of all the components in the world.
  */
 ComponentManager get componentManager =&gt; _componentManager;

 /**
  * Add a manager into this world. It can be retrieved later. World will
  * notify this manager of changes to entity.
  */
 void addManager(Manager manager) {
   _managers[manager.runtimeType] = manager;
   _managersBag.add(manager);
   manager._world = this;
 }

 /**
  * Returns a [Manager] of the specified [managerType].
  */
 Manager getManager(Type managerType) {
   return _managers[managerType];
 }

 /**
  * Deletes the manager from this world.
  */
 void deleteManager(Manager manager) {
   _managers.remove(manager.runtimeType);
   _managersBag.remove(manager);
 }

 /**
  * Create and return a new or reused [Entity] instance.
  */
 Entity createEntity() {
   return _entityManager._createEntityInstance();
 }

 /**
  * Get an [Entity] having the specified [entityId].
  */
 Entity getEntity(int entityId) {
   return _entityManager._getEntity(entityId);
 }

 /**
  * Gives you all the systems in this world for possible iteration.
  */
 ReadOnlyBag&lt;EntitySystem&gt; get systems =&gt; new Bag.from(_systemsList).readOnly;

 /**
  * Adds a system to this world that will be processed by World.process().
  * If [passive] is set to true the system will not be processed by the world.
  */
 EntitySystem addSystem(EntitySystem system, {bool passive : false}) {
   system.world = this;
   system._passive = passive;

   _systems[system.runtimeType] = system;
   _systemsList.add(system);

   return system;
 }

 /**
  * Removed the specified system from the world.
  */
 void deleteSystem(EntitySystem system) {
   _systems.remove(system.runtimeType);
   _systemsList.remove(system);
 }

 /**
  * Retrieve a system for specified system type.
  */
 EntitySystem getSystem(Type type) {
   return _systems[type];
 }

 /**
  * Performs an action on each entity.
  */
 void _check(Bag&lt;Entity&gt; entities, void perform(EntityObserver, Entity)) {
   entities.forEach((entity) {
     _managersBag.forEach((manager) =&gt; perform(manager, entity));
     _systemsList.forEach((system) =&gt; perform(system, entity));
   });
   entities.clear();
 }

 /**
  * Processes all changes to entities and executes all non-passive systems.
  */
 void process() {
   processEntityChanges();

   _systemsList.forEach((system) {
     if (!system.passive) {
       system.process();
     }
   });
 }

 /**
  *Processes all changes to entities.
  */
 void processEntityChanges() {
   _check(_added, (observer, entity) =&gt; observer.added(entity));
   _check(_changed, (observer, entity) =&gt; observer.changed(entity));
   _check(_disable, (observer, entity) =&gt; observer.disabled(entity));
   _check(_enable, (observer, entity) =&gt; observer.enabled(entity));
   _check(_deleted, (observer, entity) =&gt; observer.deleted(entity));

   _componentManager.clean();
 }

 /**
  * Removes all entities from the world.
  *
  * Every entity and component has to be created anew. Make sure not to reuse
  * [Component]s that were added to an [Entity] and referenced in you code
  * because they will be added to a free list and might be overwritten once a
  * new [Component] of that type is created.
  */
 void deleteAllEntities() {
   entityManager._entities.forEach((entity) {
     if (null != entity) {
       deleteEntity(entity);
     }
   });
   processEntityChanges();
 }

 /**
  * Adds a [Entity e] to this world.
  */
 void addEntity(Entity e) =&gt; _added.add(e);

 /**
  * Ensure all systems are notified of changes to this [Entity e]. If you're
  * adding a [Component] to an [Entity] after it's been added to the world, then
  * you need to invoke this method.
  */
 void changedEntity(Entity e) =&gt; _changed.add(e);

 /**
  * Delete the [Entity e] from the world.
  */
 void deleteEntity(Entity e) {
   if (!_deleted.contains(e)) {
     _deleted.add(e);
   }
 }

 /**
  * (Re)enable the [Entity e] in the world, after it having being disabled. Won't
  * do anything unless it was already disabled.
  */
 void enable(Entity e) =&gt; _enable.add(e);

 /**
  * Disable the [Entity e] from being processed. Won't delete it, it will
  * continue to exist but won't get processed.
  */
 void disable(Entity e) =&gt; _disable.add(e);
}
</pre>
</div>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="World">
<button class="show-code">Code</button>
new <strong>World</strong>() <a class="anchor-link" href="#World"
              title="Permalink to World.World">#</a></h4>
<div class="doc">
<pre class="source">
World() {
 addManager(_entityManager);
 addManager(_componentManager);
}
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="componentManager">
<button class="show-code">Code</button>
final <a href="../dartemis/ComponentManager.html">ComponentManager</a>         <strong>componentManager</strong> <a class="anchor-link"
            href="#componentManager"
            title="Permalink to World.componentManager">#</a>
        </h4>
        <div class="doc">
<p>Returns a manager that takes care of all the components in the world.</p>
<pre class="source">
ComponentManager get componentManager =&gt; _componentManager;
</pre>
</div>
</div>
<div class="field"><h4 id="delta">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/num.html">num</a>         <strong>delta</strong> <a class="anchor-link"
            href="#delta"
            title="Permalink to World.delta">#</a>
        </h4>
        <div class="doc">
<pre class="source">
num delta
</pre>
</div>
</div>
<div class="field"><h4 id="entityManager">
<button class="show-code">Code</button>
final <a href="../dartemis/EntityManager.html">EntityManager</a>         <strong>entityManager</strong> <a class="anchor-link"
            href="#entityManager"
            title="Permalink to World.entityManager">#</a>
        </h4>
        <div class="doc">
<p>Returns a manager that takes care of all the entities in the world.
entities of this world.</p>
<pre class="source">
EntityManager get entityManager =&gt; _entityManager;
</pre>
</div>
</div>
<div class="field"><h4 id="systems">
<button class="show-code">Code</button>
final <a href="../dartemis/ReadOnlyBag.html">ReadOnlyBag</a>&lt;<a href="../dartemis/EntitySystem.html">EntitySystem</a>&gt;         <strong>systems</strong> <a class="anchor-link"
            href="#systems"
            title="Permalink to World.systems">#</a>
        </h4>
        <div class="doc">
<p>Gives you all the systems in this world for possible iteration.</p>
<pre class="source">
ReadOnlyBag&lt;EntitySystem&gt; get systems =&gt; new Bag.from(_systemsList).readOnly;
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="addEntity">
<button class="show-code">Code</button>
void <strong>addEntity</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#addEntity"
              title="Permalink to World.addEntity">#</a></h4>
<div class="doc">
<p>Adds a <code>Entity e</code> to this world.</p>
<pre class="source">
void addEntity(Entity e) =&gt; _added.add(e);
</pre>
</div>
</div>
<div class="method"><h4 id="addManager">
<button class="show-code">Code</button>
void <strong>addManager</strong>(<a href="../dartemis/Manager.html">Manager</a> manager) <a class="anchor-link" href="#addManager"
              title="Permalink to World.addManager">#</a></h4>
<div class="doc">
<p>Add a manager into this world. It can be retrieved later. World will
notify this manager of changes to entity.</p>
<pre class="source">
void addManager(Manager manager) {
 _managers[manager.runtimeType] = manager;
 _managersBag.add(manager);
 manager._world = this;
}
</pre>
</div>
</div>
<div class="method"><h4 id="addSystem">
<button class="show-code">Code</button>
<a href="../dartemis/EntitySystem.html">EntitySystem</a> <strong>addSystem</strong>(<a href="../dartemis/EntitySystem.html">EntitySystem</a> system, {<a href="http://api.dartlang.org/dart_core/bool.html">bool</a> passive: false}) <a class="anchor-link" href="#addSystem"
              title="Permalink to World.addSystem">#</a></h4>
<div class="doc">
<p>Adds a system to this world that will be processed by World.process().
If 
<span class="param">passive</span> is set to true the system will not be processed by the world.</p>
<pre class="source">
EntitySystem addSystem(EntitySystem system, {bool passive : false}) {
 system.world = this;
 system._passive = passive;

 _systems[system.runtimeType] = system;
 _systemsList.add(system);

 return system;
}
</pre>
</div>
</div>
<div class="method"><h4 id="changedEntity">
<button class="show-code">Code</button>
void <strong>changedEntity</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#changedEntity"
              title="Permalink to World.changedEntity">#</a></h4>
<div class="doc">
<p>Ensure all systems are notified of changes to this <code>Entity e</code>. If you're
adding a <a class="crossref" href="../dartemis/Component.html">Component</a> to an <a class="crossref" href="../dartemis/Entity.html">Entity</a> after it's been added to the world, then
you need to invoke this method.</p>
<pre class="source">
void changedEntity(Entity e) =&gt; _changed.add(e);
</pre>
</div>
</div>
<div class="method"><h4 id="createEntity">
<button class="show-code">Code</button>
<a href="../dartemis/Entity.html">Entity</a> <strong>createEntity</strong>() <a class="anchor-link" href="#createEntity"
              title="Permalink to World.createEntity">#</a></h4>
<div class="doc">
<p>Create and return a new or reused <a class="crossref" href="../dartemis/Entity.html">Entity</a> instance.</p>
<pre class="source">
Entity createEntity() {
 return _entityManager._createEntityInstance();
}
</pre>
</div>
</div>
<div class="method"><h4 id="deleteAllEntities">
<button class="show-code">Code</button>
void <strong>deleteAllEntities</strong>() <a class="anchor-link" href="#deleteAllEntities"
              title="Permalink to World.deleteAllEntities">#</a></h4>
<div class="doc">
<p>Removes all entities from the world.</p>
<p>Every entity and component has to be created anew. Make sure not to reuse
<a class="crossref" href="../dartemis/Component.html">Component</a>s that were added to an <a class="crossref" href="../dartemis/Entity.html">Entity</a> and referenced in you code
because they will be added to a free list and might be overwritten once a
new <a class="crossref" href="../dartemis/Component.html">Component</a> of that type is created.</p>
<pre class="source">
void deleteAllEntities() {
 entityManager._entities.forEach((entity) {
   if (null != entity) {
     deleteEntity(entity);
   }
 });
 processEntityChanges();
}
</pre>
</div>
</div>
<div class="method"><h4 id="deleteEntity">
<button class="show-code">Code</button>
void <strong>deleteEntity</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#deleteEntity"
              title="Permalink to World.deleteEntity">#</a></h4>
<div class="doc">
<p>Delete the <code>Entity e</code> from the world.</p>
<pre class="source">
void deleteEntity(Entity e) {
 if (!_deleted.contains(e)) {
   _deleted.add(e);
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="deleteManager">
<button class="show-code">Code</button>
void <strong>deleteManager</strong>(<a href="../dartemis/Manager.html">Manager</a> manager) <a class="anchor-link" href="#deleteManager"
              title="Permalink to World.deleteManager">#</a></h4>
<div class="doc">
<p>Deletes the manager from this world.</p>
<pre class="source">
void deleteManager(Manager manager) {
 _managers.remove(manager.runtimeType);
 _managersBag.remove(manager);
}
</pre>
</div>
</div>
<div class="method"><h4 id="deleteSystem">
<button class="show-code">Code</button>
void <strong>deleteSystem</strong>(<a href="../dartemis/EntitySystem.html">EntitySystem</a> system) <a class="anchor-link" href="#deleteSystem"
              title="Permalink to World.deleteSystem">#</a></h4>
<div class="doc">
<p>Removed the specified system from the world.</p>
<pre class="source">
void deleteSystem(EntitySystem system) {
 _systems.remove(system.runtimeType);
 _systemsList.remove(system);
}
</pre>
</div>
</div>
<div class="method"><h4 id="disable">
<button class="show-code">Code</button>
void <strong>disable</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#disable"
              title="Permalink to World.disable">#</a></h4>
<div class="doc">
<p>Disable the <code>Entity e</code> from being processed. Won't delete it, it will
continue to exist but won't get processed.</p>
<pre class="source">
void disable(Entity e) =&gt; _disable.add(e);
</pre>
</div>
</div>
<div class="method"><h4 id="enable">
<button class="show-code">Code</button>
void <strong>enable</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#enable"
              title="Permalink to World.enable">#</a></h4>
<div class="doc">
<p>(Re)enable the <code>Entity e</code> in the world, after it having being disabled. Won't
do anything unless it was already disabled.</p>
<pre class="source">
void enable(Entity e) =&gt; _enable.add(e);
</pre>
</div>
</div>
<div class="method"><h4 id="getEntity">
<button class="show-code">Code</button>
<a href="../dartemis/Entity.html">Entity</a> <strong>getEntity</strong>(<a href="http://api.dartlang.org/dart_core/int.html">int</a> entityId) <a class="anchor-link" href="#getEntity"
              title="Permalink to World.getEntity">#</a></h4>
<div class="doc">
<p>Get an <a class="crossref" href="../dartemis/Entity.html">Entity</a> having the specified 
<span class="param">entityId</span>.</p>
<pre class="source">
Entity getEntity(int entityId) {
 return _entityManager._getEntity(entityId);
}
</pre>
</div>
</div>
<div class="method"><h4 id="getManager">
<button class="show-code">Code</button>
<a href="../dartemis/Manager.html">Manager</a> <strong>getManager</strong>(<a href="http://api.dartlang.org/dart_core/Type.html">Type</a> managerType) <a class="anchor-link" href="#getManager"
              title="Permalink to World.getManager">#</a></h4>
<div class="doc">
<p>Returns a <a class="crossref" href="../dartemis/Manager.html">Manager</a> of the specified 
<span class="param">managerType</span>.</p>
<pre class="source">
Manager getManager(Type managerType) {
 return _managers[managerType];
}
</pre>
</div>
</div>
<div class="method"><h4 id="getSystem">
<button class="show-code">Code</button>
<a href="../dartemis/EntitySystem.html">EntitySystem</a> <strong>getSystem</strong>(<a href="http://api.dartlang.org/dart_core/Type.html">Type</a> type) <a class="anchor-link" href="#getSystem"
              title="Permalink to World.getSystem">#</a></h4>
<div class="doc">
<p>Retrieve a system for specified system type.</p>
<pre class="source">
EntitySystem getSystem(Type type) {
 return _systems[type];
}
</pre>
</div>
</div>
<div class="method"><h4 id="initialize">
<button class="show-code">Code</button>
void <strong>initialize</strong>() <a class="anchor-link" href="#initialize"
              title="Permalink to World.initialize">#</a></h4>
<div class="doc">
<p>Makes sure all managers systems are initialized in the order they were
added.</p>
<pre class="source">
void initialize() {
 _managersBag.forEach((manager) =&gt; manager.initialize());
 _systemsList.forEach((system) =&gt; system.initialize());
}
</pre>
</div>
</div>
<div class="method"><h4 id="process">
<button class="show-code">Code</button>
void <strong>process</strong>() <a class="anchor-link" href="#process"
              title="Permalink to World.process">#</a></h4>
<div class="doc">
<p>Processes all changes to entities and executes all non-passive systems.</p>
<pre class="source">
void process() {
 processEntityChanges();

 _systemsList.forEach((system) {
   if (!system.passive) {
     system.process();
   }
 });
}
</pre>
</div>
</div>
<div class="method"><h4 id="processEntityChanges">
<button class="show-code">Code</button>
void <strong>processEntityChanges</strong>() <a class="anchor-link" href="#processEntityChanges"
              title="Permalink to World.processEntityChanges">#</a></h4>
<div class="doc">
<p>Processes all changes to entities.</p>
<pre class="source">
void processEntityChanges() {
 _check(_added, (observer, entity) =&gt; observer.added(entity));
 _check(_changed, (observer, entity) =&gt; observer.changed(entity));
 _check(_disable, (observer, entity) =&gt; observer.disabled(entity));
 _check(_enable, (observer, entity) =&gt; observer.enabled(entity));
 _check(_deleted, (observer, entity) =&gt; observer.deleted(entity));

 _componentManager.clean();
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          <div>This page was generated at 2013-05-05 23:33:04.169</div>
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
